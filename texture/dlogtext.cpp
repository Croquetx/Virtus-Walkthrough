#include "VTypes.h"#include "DlogTEXT.h"#include "Layout.h"#include "Cntrl.h"#include "AppText.h" #include "AppDeflt.h"#include "AppFiles.h"#include "Unit.h"#include "VMath.h"#include "VMain.h"#include "VGraphic.h"#include "VGUtil.h"#include "VFile.h"#include "DlogPref.h"#include "VDisplay.h"#include "CadCntrl.h"#include "Texture.h"#include "TEXTTYPE.h"#include "Getfold.h"#include "textarry.h"#include "VError.h" //MERGE-JAM-FORWIN#include "VWindow.h" //JAM#include "TextItem.h"#include <stdio.h>#include <string.h>#ifndef NewFileFilterProc#define NewFileFilterProc(x)		(FileFilterProcPtr)x#endif //NewFileFilterProcenum txtResults	{	TXTcancelBFlag,		TXTdoneBFlag,	TXTupdateFlag	};int gLastTextureDialogType = 1;intTActionText::Action(char c,long modifiers)	{	int result;		if(c != V_ENTER)		result = V_EditText::Action(c,modifiers);	else		{		((TextureDialog*)thePane)->GetResults(TXTupdateFlag);		result = TRUE;		}	return result;	}intTextureDialog::cTextureDialog( Controller *ctrl)	{	TextureItem	*ti;	int	result;	Rect r;	int w, h;	int exitflag = FALSE;	V_Array *buttonGroup;	//textureName	char str[256];	//JAM		controller = ctrl;		texture_item = ctrl->GetTexture();			if (!texture_item) return 0;	oldtcType = tcType = gLastTextureDialogType;		dialogObject = NULL;		oldSettings = texture_item->settings;		// save old settings	currentSettings = texture_item->settings;		// save old settings	old_file = NULL;	current_file = NULL;	SetApplyFlag = FALSE;	//haven't done a set followed by an apply	if (texture_item->texture)		if (texture_item->texture->tt)			if (texture_item->texture->tt->class_type == TEXTURE_FILE)            	{				if(texture_item->texture->type == TEXTURE_CHUNK)					{                    	//if texture is a chunk, we need to create and open a file to get to it						old_file = new(V_File);						old_file->cFile(LOAD, MakeID('?','?','?','?'), MakeID('?','?','?','?'), "", "");						old_file->VSetLocation(((FileTextureType*)(texture_item->texture->tt))->vfsLocation);						old_file->Find();                        old_file->Open(FALSE);						old_file_is_chunk = TRUE;						chunk_io_position = ((TTChunk*)(texture_item->texture->tt))->io_position;					}				else					{						old_file = ((FileTextureType*)(texture_item->texture->tt))->file;						old_file_is_chunk = FALSE;					}				}	SetTitle(TXTT_TXTROPT);	r.left = r.top= 0;	r.right = TEXTURE_D_WIDTH;	r.bottom = TEXTURE_D_HEIGHT;	w = r.right-r.left;    h = r.bottom-r.top;	CenterDialog(&r,w,h,0);	cDialog(&r);	//JAM texture dialog big fix 4-28-94 [[[		choices = new(TextureChoicePopMenu);	choices->cItem();	//JAM added 6-13-94 for windows merge--makes dropdown have room [[[	choices->SetRect(&layoutSpec[txtrDropRect].destRect);//	VSetRect(&r, 105, 110, 205, 126);//	VSetRect(&r, 105, 110, 205, 220);//	choices->SetRect(&r);	//JAM added 6-13-94 for windows merge--makes dropdown have room ]]]	choices->SetValue(gLastTextureDialogType);	//JAM added to fix crash when choosing texture dialog page	choices->SetDialog(this);	buttonGroup = new(V_Array);	buttonGroup->cArray(0,sizeof(V_CtrlButton_Die*),4);	// do all the button die items	applyButton = new(TApplyButton);//	applyButton = new(V_CtrlButton_Die);	applyButton->cItem();//	SetRect(&r, 100, 265, 158, 285);//	applyButton->SetRect(&r);	applyButton->SetRect(&layoutSpec[txtrBApply].destRect);	applyButton->SetText(layoutSpec[txtrBApply].title);	applyButton->SetDialog(this);//	applyButton->SetFlag(doneBFlag);		//needs another flag	applyButton->SetGroup(buttonGroup);#if WINDOWS	applyButton->SetCtrlNumber(IDOK);		//needs different number#endif	revertButton = new(TRevertButton);//	revertButton = new(V_CtrlButton_Die);	revertButton->cItem();//	SetRect(&r, 168, 265, 226, 285);//	revertButton->SetRect(&r);	revertButton->SetRect(&layoutSpec[txtrBRevert].destRect);	revertButton->SetText(layoutSpec[txtrBRevert].title);	revertButton->SetDialog(this);//	revertButton->SetFlag(revertBFlag);	revertButton->SetGroup(buttonGroup);#if WINDOWS    revertButton->SetCtrlNumber(ID_VIRTUS_REVERT);#endif	okayButton = new(TOKButton);//	okayButton = new(V_CtrlButton_Die);	okayButton->cItem();//	SetRect(&r, 305, 265, 363, 285);//	okayButton->SetRect(&r);	okayButton->SetRect(&layoutSpec[txtrBOkay].destRect);	okayButton->SetText(layoutSpec[txtrBOkay].title);	okayButton->SetDialog(this);//	okayButton->SetFlag(doneBFlag);	okayButton->SetGroup(buttonGroup);#if WINDOWS	okayButton->SetCtrlNumber(IDOK);#endif		SetDefBtn(okayButton);//	cancelButton = new(V_CtrlButton_Die);	cancelButton = new(V_CtrlButton_Die);	cancelButton->cItem();//	SetRect(&r, 237, 265, 295, 285);//	cancelButton->SetRect(&r);	cancelButton->SetRect(&layoutSpec[txtrBCancel].destRect);	cancelButton->SetText(layoutSpec[txtrBCancel].title);	cancelButton->SetFlag(TXTcancelBFlag);//	cancelButton->SetFlag(cancelBFlag);	cancelButton->SetGroup(buttonGroup);#if WINDOWS    cancelButton->SetCtrlNumber(IDCANCEL);#endif	// non-die buttons	setSourceButton = new(TSetSourceButton);//	setSourceButton = new(V_CtrlButton_Die);	SetRect(&r, 270, 30, 317, 46);//	setSourceButton->cItem();//	setSourceButton->SetRect(&r);	setSourceButton->SetRect(&layoutSpec[txtrBSetSource].destRect);	setSourceButton->SetText(layoutSpec[txtrBSetSource].title);		// MERGE-GOURAUD-PRO-5	setSourceButton->SetDialog(this);//	setSourceButton->SetFlag(cancelBFlag);		//need different flag	setSourceButton->SetGroup(buttonGroup);#if WINDOWS    setSourceButton->SetCtrlNumber(IDCANCEL);	//need different num#endif	//JAM texture dialog big fix 4-28-94 ]]]			SetInterface();	Show();	while (TRUE)    	{    	int exitflag;		result = Modal();		exitflag = GetResults(result);		if(exitflag) break;		}	// reapply the texture	texture_item->ApplyTexture();		controller->Request(NULL,msgUpdate,objPolyhedron,0);	controller->Request(NULL,msgUpdate,objTextureList,0);	controller->Request(NULL,msgUpdate,objView,0);		if (dialogObject != NULL)	{		dialogObject->dTextureDialogObject();	}	//if the texture was a chunk, we had to create a new file, so we destroy it here.	if(old_file_is_chunk)	{		if(old_file)		{			old_file->Close();            old_file->dFile();        }    }	Delete();	return(result);	}void TextureDialog::SetTextureDialogType(int type) 	{ 	oldtcType = tcType;	tcType = type; 	}voidTextureDialog::Display(int type,int h,int v)	{	V_ItemList	*oldItemList;	Rect	r;		r = dataRect;	if(oldtcType!=tcType)		{		VEraseRect(&r);		SetInterface();		}	oldtcType = tcType ;	VEraseRect(&r);	choices->SetValue(tcType);	itemList->Display();	}//invalidates rect and redisplays--called when contents of//window have changed, but O/S wouldn't know thatvoidTextureDialog::ForceRedraw(void)	{#if MACINTOSH	InvalRect(&dataRect);#elif WINDOWS	InvalidateRect(theWindow->theWindow,NULL,FALSE);#endif	Display(0,0,0);	}			intTextureDialog::GetResults(int result){int exitFlag = FALSE;TextureItem *ti;	switch(result)	{	case TXTdoneBFlag:		// reset texture_item's settings		texture_item->settings = currentSettings;				if (current_file)	// set the texture to the new file and delete old file		{        	texture_item->ChangeSource(current_file);		}		controller->SetChange(TRUE);		// mark file as dirty		exitFlag = TRUE;		break;	case TXTcancelBFlag:		// don't set ti's settings		texture_item->settings = oldSettings;		if (old_file)		{			if(old_file_is_chunk)				{                texture_item->ChangeSourceChunk(old_file, chunk_io_position);				}			else            	{				texture_item->ChangeSource(old_file);            	}		}		exitFlag = TRUE;		break;	}	return exitFlag;}		voidTextureDialog::SetInterface() 	{	int	num;		//JAM added to aviod crashing when switching between pages 5-2-94	if(itemList)		if(itemList->thePane)			itemList->thePane->SetText(NULL);		if (dialogObject != NULL)	{		dialogObject->dTextureDialogObject();	}			switch(tcType)		{		case 1: dialogObject = new(TextureDialogObjectA); 		break;		case 2: dialogObject = new(TextureDialogObjectB); 		break;		case 3: dialogObject = new(TextureDialogObjectC); 		break;		}	dialogObject->cTextureDialogObject();		SetDefBtn(NULL);	if ((num = itemList->Find(&applyButton)) >= 0)		itemList->Remove(num);	if ((num = itemList->Find(&okayButton)) >= 0)		itemList->Remove(num);	if ((num = itemList->Find(&cancelButton)) >= 0)		itemList->Remove(num);	if ((num = itemList->Find(&revertButton)) >= 0)		itemList->Remove(num);	if ((num = itemList->Find(&setSourceButton)) >= 0)		itemList->Remove(num);#if VWT	// This is a hack. We can't call RemoveItem(choices) because that would	// delete the control. On Windows, all this work is being done in response	// to an update message from the control, and deleting it makes Windows	// understandably upset. choiceText is handled the same way for good measure.#if 0	if ((num = itemList->Find(&choiceText)) >= 0)		itemList->Remove(num);#endif	if ((num = itemList->Find(&choices)) >= 0)		itemList->Remove(num);#endif //VWT		itemList->dItemList();	itemList =new(V_ItemList);	itemList->cItemList();	itemList->Install(this);	// If we removed the items, then just put them back on the item list.	// Otherwise, this is the first time, so call AddItem() to install them	// for real.	if (num >= 0)		{		SetDefBtn(okayButton);		itemList->Append(&applyButton);		itemList->Append(&okayButton);		itemList->Append(&cancelButton);		itemList->Append(&revertButton);		itemList->Append(&setSourceButton);//		itemList->Append(&choiceText);		itemList->Append(&choices);		}	else		{		SetDefBtn(okayButton);		AddItem(applyButton);		AddItem(okayButton);		AddItem(cancelButton);		AddItem(revertButton);		AddItem(setSourceButton);//		AddItem(choiceText);        AddItem(choices); 		}      /* add the controls for the current preference */	dialogObject->SetInterface(this);	}void TextureDialog::GetName(char *str){	strcpy(str, currentSettings.name);}void TextureDialog::GetInfoStr(char *str)	// type does not{TextureItem *ti = controller->GetTexture();	if (ti)		ti->GetInfoStr(str);}void TextureDialog::GetTypeStrLabel(char *str){	if (current_file || old_file)	{		strcpy(str, TXTD_FRMTFORMAT);	}	else	// if no file assume it is a VDIG	{		strcpy(str, TXTD_FRMTTYPE);	}}void TextureDialog::GetInfoStrLabel(char *str){	if (current_file || old_file)	{		strcpy(str, TXTD_DIMNSNSDIM);	}	else	// if no file assume it is a VDIG	{		strcpy(str, TXTD_DIMNSNSCNL);	}}void TextureDialog::GetTypeStr(char *str){TextureItem *ti = controller->GetTexture();	if (ti)		ti->GetTypeStr(str);}void TextureDialog::GetFullPathStr(char *str){	if (current_file)	{	char str1[256];			current_file->GetFullPathStr(str);//JAM removed 9/13/94		current_file->GetFName(str1);//JAM removed 9/13/94		strcat(str, str1);	}	else if (old_file)	{	char str1[256];			old_file->GetFullPathStr(str);//JAM removed 9/13/94		old_file->GetFName(str1);//JAM removed 9/13/94		strcat(str, str1);	}	else	// if no file assume it is a VDIG	{	char str2[256];			strcpy(str, PATHVDIG);		GetInfoStr(str2);		strcat(str, str2);	}}Boolean TextureDialog::GetDecal(void){	return currentSettings.decal;}Boolean TextureDialog::GetShade(void){	return currentSettings.shade;}Boolean TextureDialog::GetColorize(void){	return currentSettings.colorize;}Boolean TextureDialog::GetHFlip(void){	return currentSettings.hFlip;}Boolean TextureDialog::GetVFlip(void){	return currentSettings.vFlip;}Boolean TextureDialog::GetHMirror(void){	return currentSettings.hMirror;}Boolean TextureDialog::GetVMirror(void){	return currentSettings.vMirror;}Boolean TextureDialog::GetUseHTile(void){	return !(currentSettings.use_real_world_size_h);}Boolean TextureDialog::GetUseVTile(void){	return !(currentSettings.use_real_world_size_v);}FFixed TextureDialog::GetHSlide(void){	return currentSettings.hSlide;}FFixed TextureDialog::GetVSlide(void){	return currentSettings.vSlide;}FFixed TextureDialog::GetRotate(void){	return currentSettings.rotate;}FFixed TextureDialog::GetHTiles(void){	return currentSettings.hTiles;}FFixed TextureDialog::GetVTiles(void){	return currentSettings.vTiles;}FFixed TextureDialog::GetHPPU(void){	return currentSettings.hPixels_per_unit;}FFixed TextureDialog::GetVPPU(void){	return currentSettings.vPixels_per_unit;}int TextureDialog::GetHUnit(void){	return currentSettings.hUnit;}int TextureDialog::GetVUnit(void){	return currentSettings.vUnit;}/*------------------------------------------------------------------------------------------*//**/intTextureDialog::GetCurrentEntries(void){char str[256];double d;int val;		if (thSize != NULL)	{		thSize->GetText(str);		val = sscanf(str, "%lf", &d);		if ((val == 0) || (d == 0.0))		{		char str[256];					thSize->SetSelect(0, 32767);			sprintf(str, VALIDNON0NUM);			AlertMessage(str);			return -1;		}		else		{			currentSettings.hPixels_per_unit = DblToFixed(d);		}	}	if (tvSize != NULL)	{		tvSize->GetText(str);		val = sscanf(str, "%lf", &d);		if ((val == 0) || (d == 0.0))		{		char str[256];					tvSize->SetSelect(0, 32767);			sprintf(str, VALIDNON0NUM);			AlertMessage(str);			return -1;		}		else		{			currentSettings.vPixels_per_unit = DblToFixed(d);		}	}	if (thTiles != NULL)	{		thTiles->GetText(str);		val = sscanf(str, "%lf", &d);		if ((val == 0) || (d == 0.0))		{		char str[256];					thTiles->SetSelect(0, 32767);			sprintf(str, VALIDNON0NUM);			AlertMessage(str);			return -1;		}		else		{			currentSettings.hTiles = DblToFixed(d);		}	}		if (tvTiles != NULL)	{		tvTiles->GetText(str);		val = sscanf(str, "%lf", &d);		if ((val == 0) || (d == 0.0))		{		char str[256];					tvTiles->SetSelect(0, 32767);			sprintf(str, VALIDNON0NUM);			AlertMessage(str);			return -1;		}		else		{			currentSettings.vTiles = DblToFixed(d);		}	}	return 0;}/************************************************************************************* * *		Base TextureDialogObject * ************************************************************************************/void TextureDialogObject::cTextureDialogObject() { }void TextureDialogObject::dTextureDialogObject()  { delete(this); }void TextureDialogObject::GetResults() { }void TextureDialogObject::SetTextureItem(struct TextureItem *ti) { 	if (dialog)		dialog->texture_item = ti; }				/*------------------------------------------------------------------------------------------*//**/voidTextureDialogObject::SetInterface(V_Dialog *dialog) {TextureDialog *dia = (TextureDialog*)dialog;TextureItem *ti = dia->controller->GetTexture();V_Text	*statText;V_CtrlButton_Die 	*button;Rect r;	V_Array		*cluster;	char str[256];VStyleRec style;		if (!ti) return;		dia->thSize = NULL;	dia->thTiles = NULL;	dia->tvSize = NULL;	dia->tvTiles = NULL;	dia->textureName = new(TNameTextBox);	dia->GetName(str);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 90, 10, 266, 26); //	dia->textureName->SetRect(&r);	dia->textureName->SetRect(&layoutSpec[txtrTName].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	dia->textureName->SetText(str);	dia->textureName->SetDialog(dia);	dia->AddItem(dia->textureName);//	dia->textureName->Install(dia);	statText = new(V_Text);		// don't care about saving this item	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 270, 10, 326, 26);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrUsedOrNot].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]#if (!(WINDOWS))	//JAM added to make 'in/not in use' in smaller font [[[	statText->GetStyle(&style);//	style.font = geneva;	style.font = vAppFont;	style.size = 9;	statText->SetStyle(&style);	//JAM added to make 'in/not in use' in smaller font ]]]#endif	if (ti->IsUsedInDocument())	{		statText->SetText(INUSE);	}	else	{		statText->SetText(NOTINUSE);	}				statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 90, 30, 266, 69); //	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrPath].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]#if (!(WINDOWS)) //don't change font in windows	//JAM added to make path in smaller font [[[	statText->GetStyle(&style);//	style.font = geneva;	style.font = vAppFont;	style.size = 9;	statText->SetStyle(&style);	//JAM added to make path in smaller font ]]]#endif	dia->GetFullPathStr(str);#if WINDOWS	//JAM--HACK to get wrapping of path in windows	{		long i,j,len;		char str2[256];		len = strlen(str);		for(i=0,j=0;(i<len)&&(j<254);i++,j++)		{			str2[j] = str[i];			if((str[i] == '/') || (str[i] == '\\'))			{				j++;                str2[j] = ' ';        	}		}		str2[j] = '\0';		strcpy(str,str2);    }#endif //WINDOWS	statText->SetText(str);//	need hook to this data item so set source button can change it	dia->SourceText = statText;	statText = new(V_Text);	statText->cItem();	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 90, 70, 314, 73); //	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrFrmtBox1].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	dia->GetTypeStr(str);	statText->SetText(str);	dia->AddItem(statText);//	statText->Install(dia);	statText = new(V_Text);		statText->cItem();	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 90, 90, 314, 93);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrDimnsns1].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	dia->GetInfoStr(str);	statText->SetText(str);	dia->AddItem(statText);//	statText->Install(dia);//	need hook to this data item so apply button can change it if necessary	dia->DimensionsText = statText;	// do all the stattext items	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 10, 10, 85, 26);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrNameLbl].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	statText->SetText(layoutSpec[txtrNameLbl].title);	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 10, 30, 85, 46);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrSrcLbl].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	statText->SetText(layoutSpec[txtrSrcLbl].title);	statText = new(V_Text);	statText->cItem();	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 10, 70, 85, 86);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrFrmtBox2].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]//	statText->Install(dia);	dia->GetTypeStrLabel(str);	statText->SetText(str);	dia->AddItem(statText);	statText = new(V_Text);		statText->cItem();	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 5, 90, 85, 106);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrDimnsns2].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	dia->GetInfoStrLabel(str);	statText->SetText(str);	dia->AddItem(statText);//	statText->Install(dia);	statText = new(V_Text);//	SetRect(&r, 65, 110, 96, 126);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);	//JAM added 6-15-94 for windows merge--uses layout stuff [[[//	SetRect(&r, 55, 110, 86, 126);	//JAM moved left//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrEditLbl].destRect);	//JAM added 6-15-94 for windows merge--uses layout stuff ]]]	statText->SetText(layoutSpec[txtrEditLbl].title);}	/*------------------------------------------------------------------------------------------*//**/voidTextureDialogObjectA::SetInterface(V_Dialog *dialog) {TextureDialog *dia = (TextureDialog*)dialog;TextureItem *ti = dia->controller->GetTexture();V_Text	*statText;V_StatTextBox *statTextBox;	//JAMV_CtrlButton_Die 	*button;Rect r;double d;V_Array		*cluster;char str[256];		TextureDialogObject::SetInterface(dialog);		if (!ti) return;	#if 0	statText = new(V_Text);	SetRect(&r, 5, 130, 140, 206);	statText->cStatText(dialog, &r,"Slide", 		teJustLeft, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	statText = new(V_Text);	SetRect(&r, 5, 210, 105, 262);	statText->cStatText(dialog, &r,"Rotate", 		teJustLeft, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	statText = new(V_Text);	SetRect(&r, 50, 155, 139, 172);	statText->cStatText(dialog, &r,"% horizontal", 		TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	statText = new(V_Text);	SetRect(&r, 50, 180, 139, 197);	statText->cStatText(dialog, &r,"% vertical", 		TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	statText = new(V_Text);	SetRect(&r, 45, 235, 102, 251);	statText->cStatText(dialog, &r,"degrees", 		TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);#endif//	statText = new(V_Text);	statTextBox = new(V_StatTextBox);	//JAM changed to stattextbox	statTextBox->cItem();	dia->AddItem(statTextBox);//	statTextBox->Install(dia);//	SetRect(&r, 141, 150, 236, 226);//	statTextBox->SetRect(&r);	statTextBox->SetRect(&layoutSpec[txtrFlipTxt].destRect);	statTextBox->SetText(layoutSpec[txtrFlipTxt].title);	// check boxes	dia->hFlip = new(THFlipCheck);	dia->hFlip->cItem();	dia->AddItem(dia->hFlip);//	dia->hFlip->Install(dia);	dia->hFlip->SetRect(&layoutSpec[txtrHrzntlTxt].destRect);//	SetRect(&r, 146, 175, 235, 192);//	dia->hFlip->SetRect(&r);	dia->hFlip->SetText(layoutSpec[txtrHrzntlTxt].title);	dia->hFlip->SetDialog(dia);	dia->hFlip->SetValue(dia->GetHFlip());	dia->vFlip = new(TVFlipCheck);	dia->vFlip->cItem();	dia->AddItem(dia->vFlip);//	dia->vFlip->Install(dia);	dia->vFlip->SetRect(&layoutSpec[txtrVrtclTxt].destRect);//	SetRect(&r, 146, 200, 235, 217);//	dia->vFlip->SetRect(&r);	dia->vFlip->SetText(layoutSpec[txtrVrtclTxt].title);	dia->vFlip->SetDialog(dia);	dia->vFlip->SetValue(dia->GetVFlip());		//JAM#if 0	dia->thSlide = new(THSlideTextBox);	SetRect(&r, 15, 155, 47, 171);	d = FixedToDbl(dia->GetHSlide());	sprintf(str, "%g", d);	dia->thSlide->cTextBox(dialog, &r, str, TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	dia->thSlide->SetDialog(dia);	dia->tvSlide = new(TVSlideTextBox);	SetRect(&r, 15, 180, 47, 196);	d = FixedToDbl(dia->GetVSlide());	sprintf(str, "%g", d);	dia->tvSlide->cTextBox(dialog, &r, str, TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	dia->tvSlide->SetDialog(dia);	dia->tRotate = new(TRotateTextBox);	SetRect(&r, 10, 237, 42, 253);	d = FixedToDbl(dia->GetRotate());	sprintf(str, "%g", d);	dia->tRotate->cTextBox(dialog, &r, str, TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	dia->tRotate->SetDialog(dia);#endif}	/*------------------------------------------------------------------------------------------*//**/voidTextureDialogObjectB::SetInterface(V_Dialog *dialog) {V_Text	*statText;V_StatTextBox *statTextBox;	//JAMTextureDialog *dia = (TextureDialog*)dialog;TextureItem *ti = dia->controller->GetTexture();Rect r;V_Array		*cluster;double d;char str[256];	if (!ti) return;	TextureDialogObject::SetInterface(dialog);	//	statText = new(V_Text);	statTextBox = new(V_StatTextBox);	//JAM changed to stattextbox	statTextBox->cItem();	dia->AddItem(statTextBox);//	statTextBox->Install(dia);//	SetRect(&r, 5, 130, 105, 204);//	statTextBox->SetRect(&r);	statTextBox->SetRect(&layoutSpec[txtrMirrorTxt].destRect);	statTextBox->SetText(layoutSpec[txtrMirrorTxt].title);//	statText = new(V_Text);	statTextBox = new(V_StatTextBox);	//JAM changed to stattextbox	statTextBox->cItem();	dia->AddItem(statTextBox);//	statTextBox->Install(dia);//	SetRect(&r, 110, 130, 363, 258);//	statTextBox->SetRect(&r);	statTextBox->SetRect(&layoutSpec[txtrCoverTxt].destRect);	statTextBox->SetText(layoutSpec[txtrCoverTxt].title);	// check boxes	dia->hMirror = new(THMirrorCheck);	dia->hMirror->cItem();	dia->AddItem(dia->hMirror);//	dia->hMirror->Install(dia);//	SetRect(&r, 10, 150, 104, 168);//	dia->hMirror->SetRect(&r);	dia->hMirror->SetRect(&layoutSpec[txtrHrzntlMrrTxt].destRect);	dia->hMirror->SetText(layoutSpec[txtrHrzntlMrrTxt].title);	dia->hMirror->SetValue(dia->GetHMirror());	dia->hMirror->SetDialog(dia);	dia->vMirror = new(TVMirrorCheck);	dia->vMirror->cItem();	dia->AddItem(dia->vMirror);//	dia->vMirror->Install(dia);//	SetRect(&r, 10, 175, 89, 191);//	dia->vMirror->SetRect(&r);	dia->vMirror->SetRect(&layoutSpec[txtrVrtclMrrTxt].destRect);	dia->vMirror->SetText(layoutSpec[txtrVrtclMrrTxt].title);	dia->vMirror->SetValue(dia->GetVMirror());	dia->vMirror->SetDialog(dia);	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);//	SetRect(&r, 120, 150, 141, 165);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrHrzntlLbl].destRect);	statText->SetText(layoutSpec[txtrHrzntlLbl].title);	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);//	SetRect(&r, 120, 210, 141, 225);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrVrtclLbl].destRect);	statText->SetText(layoutSpec[txtrVrtclLbl].title);	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);//	SetRect(&r, 200, 150, 252, 166);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrHrzPxlsPer].destRect);	statText->SetText(layoutSpec[txtrHrzPxlsPer].title);	statText = new(V_Text);	statText->cItem();	dia->AddItem(statText);//	statText->Install(dia);//	SetRect(&r, 200, 210, 252, 226);//	statText->SetRect(&r);	statText->SetRect(&layoutSpec[txtrVrtPxlsPer].destRect);	statText->SetText(layoutSpec[txtrVrtPxlsPer].title);	// radio buttons	cluster = NULL;	cluster = new(V_Array);	cluster->cArray(0, sizeof(struct V_Item *), 4);	dia->hSize = new(THSizeRadio);	dia->hSize->cItem();	dia->AddItem(dia->hSize);//	dia->hSize->Install(dia);//	SetRect(&r, 140, 150, 158, 166);//	dia->hSize->SetRect(&r);	dia->hSize->SetRect(&layoutSpec[txtrHrzSzRadio].destRect);	dia->hSize->SetText("");	dia->hSize->SetValue(!dia->GetUseHTile());	dia->hSize->SetGroup(cluster);	dia->hSize->SetDialog(dia);	dia->hTile = new(THTileRadio);	dia->hTile->cItem();	dia->AddItem(dia->hTile);//	dia->hTile->Install(dia);//	SetRect(&r, 140, 175, 213, 191);//	dia->hTile->SetRect(&r);	dia->hTile->SetRect(&layoutSpec[txtrHrzTlsRadio].destRect);	dia->hTile->SetText(layoutSpec[txtrHrzTlsRadio].title);	dia->hTile->SetValue(dia->GetUseHTile());	dia->hTile->SetGroup(cluster);	dia->hTile->SetDialog(dia);	cluster = NULL;	cluster = new(V_Array);	cluster->cArray(0, sizeof(struct V_Item *), 4);	dia->vSize = new(TVSizeRadio);	dia->vSize->cItem();	dia->AddItem(dia->vSize);//	dia->vSize->Install(dia);//	SetRect(&r, 140, 210, 158, 226);//	dia->vSize->SetRect(&r);	dia->vSize->SetRect(&layoutSpec[txtrVrtSzRadio].destRect);	dia->vSize->SetText("");	dia->vSize->SetValue(!dia->GetUseVTile());	dia->vSize->SetGroup(cluster);	dia->vSize->SetDialog(dia);	dia->vTile = new(TVTileRadio);	dia->vTile->cItem();	dia->AddItem(dia->vTile);//	dia->vTile->Install(dia);//	SetRect(&r, 140, 235, 213, 251);//	dia->vTile->SetRect(&r);	dia->vTile->SetRect(&layoutSpec[txtrVrtTlsRadio].destRect);	dia->vTile->SetText(layoutSpec[txtrVrtTlsRadio].title);	dia->vTile->SetValue(dia->GetUseVTile());	dia->vTile->SetGroup(cluster);	dia->vTile->SetDialog(dia);	dia->thSize = new(THSizeTextBox);	dia->thSize->cItem();	dia->AddItem(dia->thSize);//	dia->thSize->Install(dia);//	SetRect(&r, 165, 150, 194, 166);//	dia->thSize->SetRect(&r);	dia->thSize->SetRect(&layoutSpec[txtrHrzSzEdit].destRect);	d = FixedToDbl(dia->GetHPPU());	sprintf(str, "%g", d);	dia->thSize->SetText(str);	dia->thSize->SetDialog(dia);		dia->thTiles = new(THTilesTextBox);//	VEraseRect(&r);	d = FixedToDbl(dia->GetHTiles());	dia->thTiles->cItem();	dia->AddItem(dia->thTiles);//	dia->thTiles->Install(dia);//	SetRect(&r, 220, 175, 252, 191);//	dia->thTiles->SetRect(&r);	dia->thTiles->SetRect(&layoutSpec[txtrHrzTlsEdit].destRect);	sprintf(str, "%g", d);	dia->thTiles->SetText(str);	dia->thTiles->SetDialog(dia);	dia->tvSize = new(TVSizeTextBox);	dia->tvSize->cItem();	dia->AddItem(dia->tvSize);//	dia->tvSize->Install(dia);//	SetRect(&r, 165, 210, 194, 226);//	dia->tvSize->SetRect(&r);	dia->tvSize->SetRect(&layoutSpec[txtrVrtSzEdit].destRect);	d = FixedToDbl(dia->GetVPPU());	sprintf(str, "%g", d);	dia->tvSize->SetText(str);	dia->tvSize->SetDialog(dia);	dia->tvTiles = new(TVTilesTextBox);	dia->tvTiles->cItem();	dia->AddItem(dia->tvTiles);//	dia->tvTiles->Install(dia);//	SetRect(&r, 215, 235, 247, 251);//	dia->tvTiles->SetRect(&r);	dia->tvTiles->SetRect(&layoutSpec[txtrVrtTlsEdit].destRect);	d = FixedToDbl(dia->GetVTiles());	sprintf(str, "%g", d);	dia->tvTiles->SetText(str);	dia->tvTiles->SetDialog(dia);	dia->unit1 = new(TextureUnitPopMenu1);	//JAM	dia->unit1->cItem();//	VSetRect(&r, 253, 150, 296, 166);//	VSetRect(&r, 273, 150, 316, 166);	//JAM moved right//	dia->unit1->SetRect(&r);	dia->unit1->SetRect(&layoutSpec[txtrHrzUnitPop].destRect);	((TextureUnitPopMenu1*)(dia->unit1))->SetDialog((TextureDialog*)dialog);	dia->unit1->SetValue(dia->GetHUnit());	dia->AddItem(dia->unit1);//	dia->unit1->Install(dia);		dia->unit2 = new(TextureUnitPopMenu2);	//JAM	dia->unit2->cItem();//	VSetRect(&r, 253, 210, 296, 226);//	VSetRect(&r, 273, 210, 316, 226);	//JAM moved right//	dia->unit2->SetRect(&r);	dia->unit2->SetRect(&layoutSpec[txtrVrtUnitPop].destRect);	((TextureUnitPopMenu2*)(dia->unit2))->SetDialog((TextureDialog*)dialog);	dia->unit2->SetValue(dia->GetVUnit());	dia->AddItem(dia->unit2);//	dia->unit2->Install(dia);}	/*------------------------------------------------------------------------------------------*//**/voidTextureDialogObjectC::SetInterface(V_Dialog *dialog) {V_Text	*statText;TextureDialog *dia = (TextureDialog*)dialog;V_CtrlButton_Die 	*button;Rect r;V_Array		*cluster;	TextureDialogObject::SetInterface(dialog);	// check boxes	dia->decal = new(TDecalCheck);	dia->decal->cItem();			//JAM	dia->AddItem(dia->decal);//	dia->decal->Install(dia);//	SetRect(&r, 105, 163, 273, 182);//	dia->decal->SetRect(&r);	dia->decal->SetRect(&layoutSpec[txtrDecalChkBox].destRect);	dia->decal->SetText(layoutSpec[txtrDecalChkBox].title);	dia->decal->SetValue(dia->GetDecal());	dia->decal->SetDialog(dia);	dia->shade = new(TShadeCheck);	dia->shade->cItem();			//JAM	dia->AddItem(dia->shade);//	dia->shade->Install(dia);//	SetRect(&r, 105, 183, 273, 202);//	dia->shade->SetRect(&r);	dia->shade->SetRect(&layoutSpec[txtrShadeChkBox].destRect);	dia->shade->SetText(layoutSpec[txtrShadeChkBox].title);	dia->shade->SetValue(dia->GetShade());	dia->shade->SetDialog(dia);#if 0	colorize = new(TColorizeCheck);	SetRect(&r, 10, 170, 178, 189);	colorize->cCtrlCheck(dialog, &r, "Colorize", dia->GetColorize());	colorize->SetDialog(dia);	statText = new(V_Text);	SetRect(&r, 10, 200, 77, 216);	statText->cStatText(dialog, &r,"Mapping:", 		TEXTURE_D_TJUST, TEXTURE_D_TFONT, TEXTURE_D_TFACE, TEXTURE_D_TSIZE);	map = new(TextureMappingPopMenu);	map->ctheMenu(TEXTURE_D_TFONT,TEXTURE_D_TFACE,TEXTURE_D_TSIZE);	map->SetCurrent(1);	((TextureMappingPopMenu*)map)->SetDialog((TextureDialog*)dialog);	dialog->AddMenuPop(map);#endif}/*------------------------------------------------------------------------------------------*//**/voidTextureChoicePopMenu::AddItems()	{	Append(TXTRPOPFIRST);	Append(TXTRPOPPATTERN);	Append(TXTRPOPAPPEAR);	}	voidTextureChoicePopMenu::SetDialog(TextureDialog *d)	{	dialog = d;	}	//JAM altered to fix texture dialog 4-26voidTextureChoicePopMenu::Action()	{    	//JAM altered for windows 6-13-94 [[[//		dialog->SetTextureDialogType(value);		dialog->SetTextureDialogType(GetValue());		//JAM altered for windows 6-13-94 ]]]//		((TextureDialog*)thePane)->SetTextureDialogType(value);		gLastTextureDialogType = value;		V_PopMenu::Action();	}/*------------------------------------------------------------------------------------------*//**/voidTextureUnitPopMenu1::AddItems()	{	Append(TXTC_INCH);	Append(TXTC_FOOT);	Append(TXTC_YARD);	Append(TXTC_MILE);	AppendSeparator();	Append(TXTC_MMET);	Append(TXTC_CMET);	Append(TXTC_METER);	Append(TXTC_KMETER);	AppendSeparator();	Append(TXTC_POINT);	Append(TXTC_PICA);	AppendSeparator();	Append(TXTC_ANGSTROM);	Append(TXTC_PARSEC);	}	voidTextureUnitPopMenu1::SetDialog(TextureDialog *d)	{	dialog = d;	}	voidTextureUnitPopMenu1::Action()	{		dialog->currentSettings.hUnit = GetValue();		V_PopMenu::Action();	}//JAM added 21Jun94 to cause drop-down menu to display first line [[[voidTextureUnitPopMenu1::Display()	{#if WINDOWS	SetValue(value);	//force first line of drop-down to be drawn#endif    V_PopMenu::Display();	}//JAM added 21Jun94 to cause drop-down menu to display first line ]]]/*------------------------------------------------------------------------------------------*//**/voidTextureUnitPopMenu2::AddItems()	{	Append(TXTC_INCH);	Append(TXTC_FOOT);	Append(TXTC_YARD);	Append(TXTC_MILE);	AppendSeparator();	Append(TXTC_MMET);	Append(TXTC_CMET);	Append(TXTC_METER);	Append(TXTC_KMETER);	AppendSeparator();	Append(TXTC_POINT);	Append(TXTC_PICA);	AppendSeparator();	Append(TXTC_ANGSTROM);	Append(TXTC_PARSEC);	}	voidTextureUnitPopMenu2::SetDialog(TextureDialog *d)	{	dialog = d;	}	voidTextureUnitPopMenu2::Action()	{		dialog->currentSettings.vUnit = GetValue();		V_PopMenu::Action();	}//JAM added 21Jun94 to cause drop-down menu to display first line [[[voidTextureUnitPopMenu2::Display()	{#if WINDOWS	SetValue(value);	//force first line of drop-down to be drawn#endif    V_PopMenu::Display();	}//JAM added 21Jun94 to cause drop-down menu to display first line ]]]/*------------------------------------------------------------------------------------------*//**/voidTextureTextBox::SetDialog(TextureDialog *d)	{	dialog = d;	}int TNameTextBox::Action(char ch, long modifiers) {	if(ch==V_TAB) 	// MERGE-GOURAUD-PRO-12 had ch==V_RETURN || ch==V_ENTER ||	{		char str[256];			GetText(str);			strcpy(dialog->currentSettings.name, str);		if (ch == V_TAB) return V_EditText::Action(ch,modifiers);		else return TRUE;	}	else 		return V_EditText::Action(ch,modifiers);}void TNameTextBox::Activate(int state) {	V_EditText::Activate(state);}int THSlideTextBox::Action(char ch, long modifiers) {	}int TVSlideTextBox::Action(char ch, long modifiers) 	{return 0;	}int TRotateTextBox::Action(char ch, long modifiers) 	{return 0;	}int THSizeTextBox::Action(char ch, long modifiers) {	if(ch==V_TAB) 	// MERGE-GOURAUD-PRO-12 had ch==V_RETURN || ch==V_ENTER ||	{		char str[256];		double d;		int val;					GetText(str);			val = sscanf(str, "%lf", &d);			if (val == 0)			{			char str[256];							SetSelect(0, 32767);				sprintf(str, VALIDNUM);				AlertMessage(str);				return TRUE;			}			else			{				dialog->currentSettings.hPixels_per_unit = DblToFixed(d);				if (ch == V_TAB) return V_EditText::Action(ch,modifiers);				else return TRUE;			}	}	else 		return V_EditText::Action(ch,modifiers);}int TVSizeTextBox::Action(char ch, long modifiers) {	if(ch==V_TAB) 	// MERGE-GOURAUD-PRO-12 had ch==V_RETURN || ch==V_ENTER ||	{		char str[256];		double d;		int val;					GetText(str);			val = sscanf(str, "%lf", &d);			if (val == 0)			{			char str[256];							SetSelect(0, 32767);				sprintf(str, VALIDNUM);				AlertMessage(str);				return TRUE;			}			else			{				dialog->currentSettings.vPixels_per_unit = DblToFixed(d);			}			if (ch == V_TAB) return V_EditText::Action(ch,modifiers);			else return TRUE;	}	else 		return V_EditText::Action(ch,modifiers);}int THTilesTextBox::Action(char ch, long modifiers) {	if(ch==V_TAB) 	// MERGE-GOURAUD-PRO-12 had ch==V_RETURN || ch==V_ENTER ||	{		char str[256];		double d;		int val;					GetText(str);			val = sscanf(str, "%lf", &d);			if (val == 0)			{			char str[256];							SetSelect(0, 32767);				sprintf(str, VALIDNUM);				AlertMessage(str);				return TRUE;			}			else			{				dialog->currentSettings.hTiles = DblToFixed(d);				if (ch == V_TAB) return V_EditText::Action(ch,modifiers);				else return TRUE;			}	}	else 		return V_EditText::Action(ch,modifiers);}int TVTilesTextBox::Action(char ch, long modifiers) {	if(ch==V_TAB) 	// MERGE-GOURAUD-PRO-12 had ch==V_RETURN || ch==V_ENTER ||	{		char str[256];		double d;		int val;					GetText(str);			val = sscanf(str, "%lf", &d);			if (val == 0)			{			char str[256];							SetSelect(0, 32767);				sprintf(str, VALIDNUM);				AlertMessage(str);				return TRUE;			}			else			{				dialog->currentSettings.vTiles = DblToFixed(d);				if (ch == V_TAB) return V_EditText::Action(ch,modifiers);				else return TRUE;			}	}	else 		return V_EditText::Action(ch,modifiers);}void TSetSourceButton::Action()	{#if MACINTOSHTextureItem *ti;TextureDialog *dia = (TextureDialog*)dialog;	StandardFileReply sfReply;	extern int gQuickTime;	VfsLocation *vfs;	int i;			V_CtrlButton::Action();		ti = pcc(dialog->controller)->GetTexture();		if (ti == NULL) return;		// if QuickTime is installed we get the nifty automatic preview dialog box		if (gQuickTime)			// ¥¥¥¥¥¥¥ debug (should test for quicktime and system 7)		{			StandardGetFilePreview(NewFileFilterProc(FolderFFilter),-1,NULL,&sfReply);			if (!sfReply.sfGood) return;			if (dia->current_file == NULL)			{				dia->current_file = new(V_File);				dia->current_file->cFile(REFERENCE, MakeID('?','?','?','?'),						MakeID('?','?','?','?'), "", "");			}			vfs = new(VfsLocation);            vfs->cVfsLocation();			for(i=0;i<63;i++)vfs->name[i]=sfReply.sfFile.name[i];			P2Cstr((Char*)vfs->name);			vfs->directory = sfReply.sfFile.parID;			vfs->volume = sfReply.sfFile.vRefNum;			vfs->alias = NULL;			dia->current_file->VSetLocation(vfs);			dia->current_file->Find();            vfs->dVfsLocation();		}		else		{		V_File *f;		int err;		char str[256];					f = new(V_File);			f->cFile(LOAD, appFileTypePICT, MakeID('?','?','?','?'), "", "");			f->AddFType(appFileTypePICT, "");			if (gQuickTime)				f->AddFType(appFileTypeQuickTime, "");			err = f->Find();			if (err != noErr) return;            vfs = new(VfsLocation);			vfs->cVfsLocation();			f->VGetLocation(vfs);						if (dia->current_file == NULL)			{				dia->current_file = new(V_File);				dia->current_file->cFile(REFERENCE, MakeID('?','?','?','?'),						MakeID('?','?','?','?'), "", "");			}			dia->current_file->VSetLocation(vfs);			dia->current_file->Find();			vfs->dVfsLocation();			// set the texture file for this texture to the current file//			ti->TextureVFile(dia->current_file);			f->dFile();	//JAM added!!! QQQ		}		{			char str[256];			dia->GetFullPathStr(str);			#if WINDOWS	//JAM--HACK to get wrapping of path in windows			{			long i,j,len;			char str2[256];			len = strlen(str);			for(i=0,j=0;(i<len)&&(j<254);i++,j++)			{				str2[j] = str[i];				if((str[i] == '/') || (str[i] == '\\'))				{					j++;	                str2[j] = ' ';    	    	}			}			str2[j] = '\0';			strcpy(str,str2);		    }			#endif //WINDOWS			dia->SourceText->SetText(str);			dia->GetInfoStr(str);            dia->DimensionsText->SetText(str);		}		// update the dialog//		dialog->SetInterface();        //redraw the dialog		dialog->ForceRedraw();	#else//	#error//JAM PORTTOWINQQQ//FSSpec fSpec;TextureItem *ti;TextureDialog *dia = (TextureDialog*)dialog;VfsLocation *vfs;int result = 0;int i;char str[256];V_File *file;int err;//JAM PORTTOWINQQQ//#error we need to get a VfsLocation with a folder in it	ti = pcc(dialog->controller)->GetTexture();	if (ti == NULL) return;	file = new(V_File);	file->cFile(REFERENCE, 0,0,"","");	sprintf(str,TXTT_SLCTTXTR);	file->SetQuery(LOADAS,str);	file->AddFType(appFileTypeBMP,appFilterDescriptorBMP);	err = file->Find();	if(err)	{		//canceled or messed up; don't change		file->dFile();        return;//    	DEBUGGER();	}	else	{		vfs = new(VfsLocation);        vfs->cVfsLocation();		file->VGetLocation(vfs);    }	if (dia->current_file == NULL)		{		dia->current_file = new(V_File);		dia->current_file->cFile(REFERENCE, 0, 0, "", "");		}	dia->current_file->VSetLocation(vfs);	dia->current_file->Find();		{			char str[256];			dia->GetFullPathStr(str);			#if WINDOWS	//JAM--HACK to get wrapping of path in windows			{			long i,j,len;			char str2[256];			len = strlen(str);			for(i=0,j=0;(i<len)&&(j<254);i++,j++)			{				str2[j] = str[i];				if((str[i] == '/') || (str[i] == '\\'))				{					j++;	                str2[j] = ' ';    	    	}			}			str2[j] = '\0';			strcpy(str,str2);		    }			#endif //WINDOWS			dia->SourceText->SetText(str);			dia->GetInfoStr(str);            dia->DimensionsText->SetText(str);		}			thePane->UnsetPane();			thePane->SetPane();					// update the dialog//		dia->SetInterface();		//redraw the dialog		dia->ForceRedraw();	vfs->dVfsLocation();	file->dFile();#endif // MACINTOSH	}void TApplyButton::Action()	{TextureItem *ti;TextureDialog *dia = (TextureDialog*)dialog;char str[256];		V_CtrlButton::Action();		//JAM need this so that if a user changes the name in the edit textbox and        //hits "apply" without hitting return, then the change still "registers"        dia->textureName->GetText(dia->currentSettings.name);		ti = pcc(dialog->controller)->GetTexture();		if (ti)		{		int val;					// update the current settings and return if not valid			val = dia->GetCurrentEntries();			if (val != noErr)				return;			ti->settings = dia->currentSettings;						if (dia->current_file)			{				// set the texture file for this texture to the current file				ti->ChangeSource(dia->current_file);				dia->GetInfoStr(str);        		dia->DimensionsText->SetText(str);				// flag the fact that we have done an apply which caused us to change				// the pict source				dia->SetApplyFlag = TRUE;			}			//JAM added to fix set-apply-revert-apply bug			else			{				if(dia->SetApplyFlag)				{					// set the texture file for this texture to the old file					if(dia->old_file_is_chunk)						{        		        ti->ChangeSourceChunk(dia->old_file, dia->chunk_io_position);						}					else        		    	{						ti->ChangeSource(dia->old_file);						}					dia->GetInfoStr(str);        		    dia->DimensionsText->SetText(str);					// flag the fact that we have done an apply which caused us to change					// to the pict source which is the same as at the dialog startup					dia->SetApplyFlag = FALSE;				}			}						// recalc the texture mapping for every object using this texture			ti->ApplyTexture();			// update the walk etc windows			dia->controller->Request(NULL,msgUpdate,objPolyhedron,0);			dia->controller->Request(NULL,msgForceRedraw,objTextureList,0);			dia->controller->Request(NULL,msgUpdate,objView,0);						thePane->UnsetPane();			thePane->SetPane();						// update the dialog//			dialog->SetInterface();			//redraw the dialog            dialog->ForceRedraw();		}	}void TRevertButton::Action()	{	Rect r;	double d;	char str[256];	TextureDialog *dia = (TextureDialog*)dialog;			V_CtrlButton::Action();				dialog->currentSettings = dialog->oldSettings;		if (dialog->current_file)		{			dialog->current_file->dFile();			dialog->current_file = NULL;		}		if (dia->thSize != NULL)		{			d = FixedToDbl(dia->GetHPPU());			sprintf(str, "%g", d);			dia->thSize->SetText(str);		}		if (dia->tvSize != NULL)		{			d = FixedToDbl(dia->GetVPPU());			sprintf(str, "%g", d);			dia->tvSize->SetText(str);		}		if (dia->thTiles != NULL)		{			d = FixedToDbl(dia->GetHTiles());			sprintf(str, "%g", d);			dia->thTiles->SetText(str);		}		if (dia->tvTiles != NULL)		{			d = FixedToDbl(dia->GetVTiles());	//JAM switched from GetH to GetV			sprintf(str, "%g", d);			dia->tvTiles->SetText(str);		}					dialog->SetInterface();			//redraw the dialog            dialog->ForceRedraw();		// MERGE-GOURAUD-PRO-11	}voidTOKButton::Action(){TextureItem *ti;TextureDialog *dia = (TextureDialog*)dialog;	V_CtrlButton::Action();	//JAM need this so that if a user changes the name in the edit textbox and	//hits "ok" without hitting return, then the change still "registers"	dia->textureName->GetText(dia->currentSettings.name);	ti = pcc(dialog->controller)->GetTexture();	if (ti)	{	TextureItem *ti2 = ti->parent->FindByName(dia->currentSettings.name);			if ((ti2 != NULL) && (ti != ti2))		{			dia->textureName->SetSelect(0, 32767);			AlertMessage(TXT_NAMECOLLIDE);		}		else		{			if (dia->GetCurrentEntries() == noErr)			{				((V_Dialog *)thePane)->okay = TXTdoneBFlag;				//¥¥¥¥¥¥¥thePane->theWindow->SendEvent(DieWindowEvent);#if MACINTOSH				thePane->theWindow->SendEvent(DieWindowEvent);	//JAM took out of retirement#else///JAM PORTTOWINQQQ	//				((V_Dialog *)thePane)->okay = okay;				VSendMessage(DieWindowEvent);#endif			}		}	}		}	voidTextureCheck::SetDialog(TextureDialog *d)	{	dialog = d;	}voidTextureButton::SetDialog(TextureDialog *d)	{	dialog = d;	}voidTextureRadio::SetDialog(TextureDialog *d)	{	dialog = d;	}voidTHSizeRadio::Action(void)	{	V_CtrlRadio::Action();		dialog->currentSettings.use_real_world_size_h = GetValue();	}voidTHTileRadio::Action(void)	{	V_CtrlRadio::Action();		dialog->currentSettings.use_real_world_size_h = !(GetValue());	}voidTVSizeRadio::Action(void)	{	V_CtrlRadio::Action();		dialog->currentSettings.use_real_world_size_v = GetValue();	}voidTVTileRadio::Action(void)	{	V_CtrlRadio::Action();		dialog->currentSettings.use_real_world_size_v = !(GetValue());	}voidTHMirrorCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.hMirror = GetValue();	}voidTVMirrorCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.vMirror = GetValue();	}voidTDecalCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.decal = GetValue();	}voidTShadeCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.shade = GetValue();	}voidTColorizeCheck::Action(void)	{	V_CtrlCheck::Action();					dialog->currentSettings.colorize = GetValue();	}voidTHFlipCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.hFlip = GetValue();	}voidTVFlipCheck::Action(void)	{	V_CtrlCheck::Action();		dialog->currentSettings.vFlip = GetValue();	}