#include "VTypes.h"#include "VMain.h"#include "VGutil.h"#include "Blurbs.h"#include <stdlib.h>#include   <stdio.h>#if WINDOWS#include   <dos.h>#endif // WINDOWS#define TEXTBOX_ID 			331#define RESOURCE_STR_SIZE 	255//#if MACINTOSH && !DEBUG//#error Blurbs has not been converted to MAC yet.//#endif#if WINDOWSBOOL FAR PASCAL BlurbyProc(HWND hdlg, WORD wMsg, WORD wParam, LONG lParam){	int		iStatus = 0;	int 	iStringsNum = 1;    int 	iStringsBase=200;     // Put the count of strings at this resource, followed by blurbs.	char  	cbuf[257];            // >256, Perry Noid	int 	result = FALSE;	int 	length, which;	Rect	r;	int 	cx, cy, x, y, seed;	struct  time t;	switch (wMsg)		{	case WM_INITDIALOG:		length = LoadString(GetAppInstance(), iStringsBase, cbuf, RESOURCE_STR_SIZE);		if (length > 1)			{			iStatus = sscanf(cbuf, "%d", &iStringsNum);            iStringsNum = max(1, iStringsNum);		// avoid negs and divide by zeros            }		gettime(&t);		seed = t.ti_sec%iStringsNum;//		seed = rand()%MAX_NUM_STRINGS;		which = iStringsBase + 1 + seed;		length = LoadString(GetAppInstance(), which, cbuf, RESOURCE_STR_SIZE);		cbuf[length] = '\0';		SetDlgItemText(hdlg, TEXTBOX_ID, (LPSTR)cbuf);		GetWindowRect(hdlg, &r);		cx = r.right - r.left;		cy = r.bottom - r.top;		GetScreen(&r);		x = ((r.right-r.left)-cx)>>1 + r.left;		y = ((r.bottom-r.top)-cy)>>1 + r.top;		SetWindowPos(hdlg,HWND_TOP,x,y,cx,cy,SWP_NOSIZE);		break;		result = TRUE;        break;	case WM_COMMAND:		switch(wParam)			{			case IDOK:				EndDialog(hdlg, 0);				result = TRUE;				break;			}		break;		}	return(result);}#endif //WINDOWS#if MACINTOSHBlurb(Handle parent){	int num_strings;	long rnd = TickCount();	Handle strhandle = Get1Resource('STR ', 5000);			if (strhandle != NULL)	{	int i;	char str[257];		HLock(strhandle);		for ( i=0;i<256;i++)			str[i] = ((char *)*strhandle)[i];		P2Cstr(str);		sscanf(str, "%d", &num_strings);		HUnlock(strhandle);		ReleaseResource(strhandle);	}	else		num_strings = 16;		rnd = rnd > 0 ? rnd : -rnd;	rnd = (short)5011 + (short)(rnd % num_strings);	strhandle = Get1Resource('STR ', (short)rnd);		if (strhandle != NULL)		HLock(strhandle);	if (strhandle == NULL)		ParamText((StringPtr)"\pFor information about Virtus WalkThrough Pro 2.0, call Virtus Customer Service at 1-800-847-8871.", "\p", "\p", "\p");	else		ParamText((StringPtr)*strhandle, "\p", "\p", "\p");		Alert(5000, nil);	if (strhandle != NULL)		HUnlock(strhandle);	if (strhandle != NULL)		ReleaseResource(strhandle);	return 0;}#else // WINDOWSvoidBlurb(HWND parent)	{	FARPROC	dlogBoxProc;	int err = 0;	dlogBoxProc = MakeProcInstance((FARPROC)BlurbyProc, GetAppInstance());	if (dlogBoxProc)		{		DialogBox(GetAppInstance(), "Blurb", parent, dlogBoxProc);		FreeProcInstance(dlogBoxProc);		}}#endif