/*------------------------------------------------------------------------------ * Virtus WalkThrough_ * Version 1.1.1 * * Copyright _ 1990-1992 by Virtus Corporation * All Rights Reserved                                            * Written by   *				 *				Mark J. Uland * Virtus Corporation * Suite 204 * 117 Edinburgh South * Cary, North Carolina    27511 * (919) 467-9700 *------------------------------------------------------------------------------ * Source File:  * Notes:  * History:  *------------------------------------------------------------------------------ */#include "VTypes.h"#include "WMenus.h"#include "WalkThru.h"#include "CVWCntrl.h"#include "Library.h"#include "UndoBuf.h"#include "AppMssgs.h"#include "AppDeflt.h"#include "AppText.h"#include "DlogTran.h"#include "ToolDef.h"#include "Observer.h"#include "VgerFile.h"#include "VDocumnt.h"	// jca 14JAN94#include "VGUtil.h"#include "VAbout.h"#include "VMemUtil.h"#include "VMain.h"#include "VPrint.h"#include "VGestalt.h"#include "VFile.h"#include "VWindow.h"#include "VError.h"#include "VwCntrl.h"#include "Polyhdrn.h"#include "WalkPane.h"	// jca 2Nov 93.  For the walkmenu key mnemonic#include "CadDraft.h"	// jca 24MAR94 for the MenuConvert::Preempt#include "VGraphic.h"	// for VSetCursor()#if VPLAYER#include "VPlayer.h"#include "VWI.h"#include "VWCntrl.h"#include "WalkBPne.h"#endif //VPLAYER#if VWT#include "Credits.h"#if WINDOWS// jca 18MAY94 if more than one library is open, we// start crashing in CreatePopUpMenu or the system menu for the lib// window is gone or replaced by some other menu.  In short, bad things happen.extern int gIsALibraryLoaded;#endif // WINDOWS#endif //VWT#include <stdio.h>#include <string.h>extern	struct V_Buffer *clipBuf;/* in WalkThrough.c */voidMenuAbout::ctheMenu(V_Document *doc)	{	cMenu(TXTM_ABOUT_CHAR,doc);	SetMenuEuroKey(menuAboutEuroKey);	#if SPANISH	  SetMenuKeyPos(menuAboutKeyPos);   	#endif // SPANISH#if WINDOWS && VWT	// jca 27 Oct 93	Append(TXT_CONTENTS);				// PRO-JAP	Append(TXT_SEARCH_FOR_HELP);		// PRO-JAP	Append(TXT_HOW_TO_USE_HELP);		// PRO-JAP	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#endif //WINDOWS	Append(TXTM_ABOUT);#if VPLAYER	Append(TXTM_HELP);#endif //VPLAYER	SetEuroKey(menuAbout,menuAboutEuroKey);#if WINDOWS && VWT	SetEuroKey(menuHelpContents, menuHelpContentsEuroKey);	SetEuroKey(menuHelpSearch, menuHelpSearchEuroKey);	SetEuroKey(menuHelpHow, menuHelpHowEuroKey);	#if SPANISH	  SetKeyPos(menuHelpHow,menuHelpHowKeyPos);	#endif //SPANISH#endif#if VPLAYER    SetEuroKey(menuHelp,menuHelpEuroKey);#endif	LinkMenu(DA_MENU);	SetPriority(aboutPriority);	}	voidMenuAbout::Action(int num, long modifier)	{#if (VPLAYER && MACINTOSH)	PlayerHelp *help;#endif //VPLAYER#if WINDOWS	HWND hwnd=NULL;	if(document)		hwnd=((WalkDocumentStub *)document)->GetFrame();#endif //WINDOWS	switch (num)		{#if WINDOWS && VWT		// jca 27 Oct 93		case menuHelpContents:			if(hwnd) WinHelp(hwnd,HELP_FILE_NAME,HELP_CONTENTS,0);			break;		case menuHelpSearch:			if(hwnd) WinHelp(hwnd,HELP_FILE_NAME,HELP_PARTIALKEY,(DWORD)"");			break;		case menuHelpHow:			if(hwnd) WinHelp(hwnd,"",HELP_HELPONHELP,0);			break;#endif //WINDOWS		case menuAbout:#if MACINTOSH			if (modifier & V_OPTION)#elif WINDOWS			if (GetKeyState(VK_CAPITAL) & 0x0001)#endif //MACINTOSH				AboutThisApplication(-1);			else				AboutThisApplication(1);			break;#if VPLAYER		case menuHelp:#if MACINTOSH			if ((help = FindHelpDocument()) == NULL)				{				help = new(PlayerHelp);				help->OpenDocument(LOADAS, NULL, NewMDI);				}			else help->Activate(NULL);#elif WINDOWS			if(hwnd) WinHelp(hwnd,HELP_FILE_NAME,HELP_CONTENTS,0);#endif //MACINTOSH			break;#endif //VPLAYER		default: DoDA(num); break;		}	}voidMenuFile::ctheMenu(V_Document *doc)	// MERGE-VR-FIX this whole section sucks.  God knows what has changed for this fix.	{		MenuImport	*importMenu;	MenuExport	*exportMenu;	MenuPlace	*placeMenu;		controller = NULL;#if VPLAYER	cMenu(TXTM_FILE,doc);	SetMenuEuroKey(menuFileEuroKey);	Append(TXTM_OPEN);	Append(TXTM_CLOSE);	AppendSeparator();	Append(TXTM_CREDITS);	AppendSeparator();	Append(TXTM_QUIT);	SetKey(menuOpen, menuOpenKey);	SetKey(menuClose, menuCloseKey);	SetKey(menuQuit, menuQuitKey);		SetEuroKey(menuOpen, menuOpenEuroKey);	SetEuroKey(menuClose, menuCloseEuroKey);    SetEuroKey(menuQuit, menuQuitEuroKey);	SetPriority(filePriority);#else	cMenu(TXTM_FILE,doc);	SetMenuEuroKey(menuFileEuroKey);	Append(TXTM_NEW);	Append(TXTM_OPEN);	Append(TXTM_CLOSE);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_SAVE);	Append(TXTM_SAVEAS);	Append(TXTM_REVSAVE);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#if (VR && (!JAPANESE))	Append(TXTM_CREDITS);	AppendSeparator();#endif //(VR && (!JAPANESE))#if MACINTOSH	Append(TXTM_PAGESET);	Append(TXTM_PRINT);#elif WINDOWS	Append(TXTM_PRINT);	Append(TXTM_PAGESET);#endif //WINDOWS	#if VPRO && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	AppendSeparator();		// MERGE-GOURAUD-PRO-4	Append(TXTM_CREDITS);	// MERGE-GOURAUD-PRO-4	SetEuroKey(menuCredits, menuCreditsEuroKey);	#endif // VPRO && !SPECIAL_EDITION	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Append(TXTM_IMPORT);	SetEuroKey(menuImport, menuImportEuroKey);#endif //VWT#if (VPRO) || (VWT && !SPECIAL_EDITION)			// merge SE, vrmadness		// GJR 7/4/95	Append(TXTM_EXPORT);	SetEuroKey(menuExport, menuExportEuroKey);#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO *** Append(TXTM_PLACE);	Append(TXTM_SNAPSHOT);	SetEuroKey(menuSnapShot, menuSnapshotEuroKey);#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Append(TXTM_MAKE_MOVIE);		// MERGE-GOURAUD-PRO	SetEuroKey(menuMakeMovie, menuMakeMovieEuroKey);#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95#if VWT	Append(TXTM_LIBRARY);	SetEuroKey(menuLibrary, menuLibraryEuroKey);#endif //VWT	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_QUIT);	SetKey(menuNew, menuNewKey);	SetKey(menuOpen, menuOpenKey);	SetKey(menuClose, menuCloseKey);	SetKey(menuSave, menuSaveKey);	SetKey(menuPrint, menuPrintKey);	SetKey(menuQuit, menuQuitKey);	    #if SPANISH	   SetKeyPos(menuCredits,menuCreditKeyPos);	   SetKeyPos(menuMakeMovie,menuMakeMovieKeyPos);	   SetKeyPos(menuSaveAs,menuSaveAsKeyPos);	   SetKeyPos(menuRevert,menuRevertKeyPos);	   SetKeyPos(menuPageSetup,menuPageSetupKeyPos);	   SetKeyPos(menuSnapShot,menuSnapshotKeyPos);	   SetKeyPos(menuQuit,menuQuitKeyPos);	   #if VPRO		  SetKeyPos(menuImport,menuImportKeyPos);       #endif //VPRO	#elif GERMAN	   SetKeyPos(menuOpen, menuOpenKeyPos);	   SetKeyPos(menuClose, menuCloseKeyPos);	   SetKeyPos(menuPageSetup,menuPageSetupKeyPos);	   SetKeyPos(menuMakeMovie,menuMakeMovieKeyPos);	   #if VPRO       	   SetKeyPos(menuSaveAs,menuSaveAsKeyPos);	   	   SetKeyPos(menuExport, menuExportKeyPos);	   	   SetKeyPos(menuLibrary, menuLibraryKeyPos);	   #endif // VPRO	#else // English default	   SetKeyPos(menuSaveAs,menuSaveAsKeyPos);	   SetKeyPos(menuRevert,menuRevertKeyPos);	   SetKeyPos(menuPageSetup,menuPageSetupKeyPos);	   SetKeyPos(menuSnapShot,menuSnapshotKeyPos);	   SetKeyPos(menuQuit,menuQuitKeyPos);    #endif // SPANISH#if VWT#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO SetKeyPos(menuPlace,menuPlaceKeyPos);#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	SetKeyPos(menuLibrary,menuLibraryKeyPos);#endif //VWT	SetKeyPos(menuQuit,menuQuitKeyPos);    SetEuroKey(menuNew, menuNewEuroKey);	SetEuroKey(menuOpen, menuOpenEuroKey);	SetEuroKey(menuClose, menuCloseEuroKey);	SetEuroKey(menuSave, menuSaveEuroKey);	SetEuroKey(menuSaveAs, menuSaveAsEuroKey);	SetEuroKey(menuRevert, menuRevertEuroKey);    SetEuroKey(menuPageSetup, menuPageSetupEuroKey);    SetEuroKey(menuPrint, menuPrintEuroKey);	SetEuroKey(menuQuit, menuQuitEuroKey);	SetPriority(filePriority);#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95  #if VWT         	// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO//importMenu = new(MenuImport);	// MERGE-GOURAUD-PRO//importMenu->ctheMenu((WalkDocumentStub*)doc);		exportMenu = new(MenuExport);	exportMenu->ctheMenu((WalkDocumentStub*)doc);		placeMenu = new(MenuPlace);	placeMenu->ctheMenu((WalkDocumentStub*)doc);	  #endif //VWT#else  //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95  #if VPRO	//VRML SE	exportMenu = new(MenuExport);	exportMenu->ctheMenu((WalkDocumentStub*)doc);	  #endif#endif //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	snapshotMenu = new(MenuSnapShot);	snapshotMenu->ctheMenu((WalkDocumentStub*)doc);	#if ((VWT)||(VPRO)||(VR))	// MERGE-VR-FIX	makemovieMenu = new(MenuMakeMovie);	makemovieMenu->ctheMenu((WalkDocumentStub*)doc);#endif#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95  #if VWT         	// merge SE, vrmadness		// GJR 7/4/95	SetHeir(menuImport,placeMenu);	// MERGE-GOURAUD-PRO	SetHeir(menuExport,exportMenu);	// MERGE-GOURAUD-PRO *** SetHeir(menuPlace,placeMenu);  #endif //VWT#else  //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95  #if VPRO // VRML SE	SetHeir(menuExport,exportMenu);  #endif#endif //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	SetHeir(menuSnapShot,snapshotMenu);#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	SetHeir(menuMakeMovie,makemovieMenu);	// MERGE-GOURAUD-PRO		// MERGE-GOURAUD-PRO-5#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95#endif //VPLAYER	}voidMenuFile::SetController(WalkController *ctrl)	{	controller = ctrl;#if (!VPLAYER) && (!VPLAYER)	snapshotMenu->SetController(controller);		makemovieMenu->SetController(controller);			// MERGE-GOURAUD-PRO-5#endif //!VPLAYER	}	voidMenuFile::Preempt()	{	Controller	*ctrl;	int		newState,memNewState,saveState,exportState,ctrlType,docType,importState,docState;	int		creditState; 	// jca don't put up the credits for the wrong types	int memoryLow;		memoryLow = CheckMemory();#if VPLAYER	Activate(menuOpen, TRUE);	Activate(menuClose, (theSuper->ALength() > 0));	if (controller)		docState = ((((Player*)document)->creditBitMap)||(((Player*)document)->creditText));	else		docState = FALSE;	Activate(menuCredits, docState);#else	docType = ((WalkDocumentStub *)document)->GetType();#if VR	if( libraryDocument == docType)		docType = ((WalkDocumentStub *)REALDOC(document))->GetType();#endif //VR	if( libraryDocument == docType)		{		newState = TRUE;		importState = FALSE;	// jca import into a library?		exportState = FALSE;		saveState = FALSE;#if VR		docState = FALSE; // BILBIL - we should not ever get here for VR!#endif //VR		creditState = FALSE;		}	else		{		if(!controller)#if VWT			ctrlType = toolCRTLWalk;#elif VR			ctrlType = toolCRTLWalkStub;#endif //VWT		else			{			ctrl = controller->GetFrontController();			ctrlType = ctrl->GetType();			}				switch(ctrlType)			{#if VR			case toolCRTLLibrary: importState = TRUE; newState = FALSE;  saveState = FALSE;							exportState = FALSE; docState = FALSE; creditState = FALSE; break;#endif //VR			case toolCRTLWalk: importState = FALSE; newState = FALSE; saveState = FALSE;							exportState = FALSE; docState = TRUE; creditState = FALSE; break;			case toolCRTLTool: importState = FALSE; newState = TRUE;  saveState = FALSE;							exportState = FALSE; docState = TRUE; creditState = TRUE; break;			case toolCRTLWalkStub: importState = FALSE; newState = FALSE; saveState = FALSE;							exportState = FALSE; docState = FALSE; creditState = FALSE; break;			case toolCRTLDesign:  importState = TRUE; newState = TRUE;  saveState = TRUE;							exportState = TRUE; docState = TRUE; creditState = TRUE; break;			default: 		 importState = TRUE; newState = TRUE;  saveState = TRUE;							exportState = TRUE; docState = TRUE; creditState = TRUE; break;			}		}			importState = (memoryLow) ? FALSE : importState;	exportState = (memoryLow) ? FALSE : exportState;	memNewState = (memoryLow) ? FALSE : newState;		Activate(menuNew, (memoryLow) ? FALSE : TRUE);	Activate(menuOpen, (memoryLow) ? FALSE : TRUE);	#if VPRO && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Activate(menuCredits, creditState && (!memoryLow && (theSuper->ALength() > 0)));  // PRO-17#endif#if VWT#if WINDOWS	// jca 18MAY94 vwt 1.2 win can't open more than one lib or there is menu funkiness in the 2nd, 3rd, ... libraries.	Activate(menuLibrary, ((memoryLow) || (gIsALibraryLoaded)) ? FALSE : TRUE);#elif MACINTOSH   	#if SPECIAL_EDITION		// ABD-VRML3	{ // ABD-VRML4	extern int gIsALibraryLoaded;	Activate(menuLibrary, ((memoryLow) || (gIsALibraryLoaded)) ? FALSE : TRUE);		// ABD-VRML3	} // ABD-VRML4	#else		// ABD-VRML3	Activate(menuLibrary, (memoryLow) ? FALSE : TRUE);	#endif		// ABD-VRML3#endif // WINDOWS #if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO *** Activate(menuImport,importState);	Activate(menuExport, exportState); 	// MERGE-GOURAUD-PRO *** Activate(menuPlace, ((ctrlType == toolCRTLDesign) && !memoryLow) ? TRUE : FALSE);	Activate(menuImport, ((ctrlType == toolCRTLDesign) && !memoryLow) ? TRUE : FALSE);  #else  //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95  #if VPRO  // VRML SE	Activate(menuExport, exportState);  #endif #endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95#elif VR	Activate(menuOpen, TRUE);	Activate(menuNew, TRUE);#if (!JAPANESE)	if (ctrlType != toolCRTLWalkStub)		{		CAVWalkController	*cvWlkCtrl;				cvWlkCtrl = (CAVWalkController*)controller;		Activate(menuCredits, (cvWlkCtrl->creditScreen)||				(cvWlkCtrl->creditText));		}	else		Activate(menuCredits, FALSE);#endif //!JAPANESE#endif //VWT	Activate(menuSnapShot, exportState);#if (VWT||VPRO) && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Activate(menuMakeMovie, exportState); // MERGE-GOURAUD-PRO#endif	Activate(menuClose, newState);#if SAVE_DISABLED // jca 22Feb95	Activate(menuSave, FALSE);	Activate(menuSaveAs, FALSE);#else // SAVE_DISABLED	Activate(menuSave, saveState);	Activate(menuSaveAs, saveState);#endif //!SAVE_DISABLED // jca 22Feb95	Activate(menuRevert, (!memoryLow && document->Changed()) ? TRUE : FALSE);#if SAVE_DISABLED // jca 22Feb95	Activate(menuPageSetup, FALSE);	Activate(menuPrint, FALSE);#else	Activate(menuPageSetup, memNewState); #if WINDOWS	if (document->GetVPrint() != NULL)		Activate(menuPrint, ((memNewState && (document->GetVPrint())->GetPrinterStatus())?TRUE:FALSE)); #elif MACINTOSH	Activate(menuPrint, memNewState); #endif //WINDOWS#endif //!SAVE_DISABLED // jca 22Feb95#endif //VPLAYER	}	voidMenuFile::Action(int num, long modifier)	{	Library	*library;	#if VPLAYER	switch (num)		{		case menuOpen: 			NewDocument(NULL,LOADAS);			break;		case menuClose:			document->Close();			break;		case menuCredits:			((Player*)document)->ShowPlayerCredits();			break;		case menuQuit:			document->Quit();			break;		}#else	switch (num)		{		case menuNew: document->New(); break;		case menuOpen: #if VWT			if(document->Load(LOADOVER))				{				document->CloseDocument();				document->New();                }#elif VR			NewDocument(NULL,LOADAS);#endif //VWT			break;		case menuClose: document->Close(); break;		#if VPRO && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO-4		case menuCredits:			((CAVWalkController*)controller)->GetCredits();			break;		#endif#if VWT		case menuLibrary: #if WINDOWS			// jca 18May94 vwt win 1.2 can't more than 1 library or we get menu funkiness			if (gIsALibraryLoaded)	break;#endif // WINDOWS			library = new(Library); 			library->OpenDocument(LOADAS,NULL, NewMDI); 			break; #if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95		case menuImport:break;		case menuExport:break;		// MERGE-GOURAUD-PRO **** case menuPlace:break; #else  //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95  #if VPRO  // VRML SE		case menuExport:break;  #endif #endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95#elif (VR && (!JAPANESE))		case menuCredits:			((CAVWalkController*)controller)->ShowPlayerCredits();			break;#endif //VWT#if !SAVE_DISABLED // jca 22Feb95		case menuSave: document->Save(SAVE); break;		case menuSaveAs: document->Save(SAVEAS); break;#endif //!SAVE_DISABLED // jca 22Feb95		case menuRevert:			if (document->Untitled())            	{				document->CloseDocument();				document->New();                }			else				{  // BILBIL 7 FEB94 fix the revert to saved do-wop crash.				document->closing = TRUE;				if(document->Load(LOAD))					document->CloseDocument();				else					document->closing = FALSE;                }			break;			#if !SAVE_DISABLED // jca 22Feb95		case menuPageSetup: VSendMessage(PRINT_SETUP); break;		case menuPrint: if(!(modifier&V_SHIFT)){ VSendMessage(MSG_PRINT);break;}		case menuSnapShot: pdc(((WalkDocumentStub *)document))->Import(export,formatSameSnap); break; #if (VWT||VPRO) && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95		case menuMakeMovie: /* ABD MERGE-GOURAUD-PRO ?????? */ break; #endif#endif //!SAVE_DISABLED // jca 22Feb95		case menuQuit: document->Quit(); break;		}#endif //VPLAYER	}#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95voidMenuImport::ctheMenu(WalkDocumentStub *doc)	{		cMenu(TXTM_IMPORT,doc);	Append(TXTM_DXF3D);	SetKeyPos(menuImportDXF3D,menuDXF3DKeyPos);	}	voidMenuImport::Action(int num, long modifier)	{	if(menuImportDXF3D == num)		((WalkDocumentStub *)document)->Import(import,format3DDXF);	}#endif#if (VPRO) || (VWT && !SPECIAL_EDITION)	voidMenuExport::ctheMenu(WalkDocumentStub *doc)	{	char voyagerTM[256];	VoyagerFile *vFile;	int vger;	strcpy(voyagerTM, TXTM_VOYAGER);    strcat(voyagerTM, TXTM_TM);	cMenu(TXTM_EXPORT,doc);#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95#if MACINTOSH#if !VPRO 	// MERGE-GOURAUD-PRO-11	Append(TXTM_CLARISCAD);#endif 	// MERGE-GOURAUD-PRO-11	Append(TXTM_DXF2D);#if !VPRO 	// MERGE-GOURAUD-PRO-11	Append(TXTM_MACDRAWII);#endif 	// MERGE-GOURAUD-PRO-11	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_DXF3D);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_PLAYER);	// MERGE-GOURAUD-PRO-3 (was voyagerTM)		#if VRML_ANCHOR				// VRML-ABD 23JUN95	AppendSeparator();				Append(TXTM_VRML);		#endif // VRML_ANCHOR	SetKeyPos(menuExportDXF2D,menuDXF2DKeyPos);	SetKeyPos(menuExportDXF3D,menuDXF3DKeyPos);	SetEuroKey(menuExportDXF2D,menuExportDXF2DEuroKey);	SetEuroKey(menuExportDXF3D,menuExportDXF3DEuroKey);	SetEuroKey(menuExportVoyager,menuExportPlayerEuroKey);	//need to change voyager to player			#if VRML_ANCHOR				// VRML-ABD 23JUN95	SetKeyPos(menuExportVRML,menuVRMLKeyPos);			// what does this mean??? fix this!!!!	SetEuroKey(menuExportVRML,menuExportVRMLEuroKey);	// what does this mean??? fix this!!!!	#endif // VRML_ANCHOR#elif WINDOWS	Append(TXTM_DXF2D);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93    Append(TXTM_DXF3D);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_PLAYER);	// MERGE-GOURAUD-PRO-3 (was voyagerTM)		#if VRML_ANCHOR				// VRML-ABD 23JUN95	AppendSeparator();				Append(TXTM_VRML);		#endif // VRML_ANCHOR	SetKeyPos(menuExportDXF2D,menuDXF2DKeyPos);	SetKeyPos(menuExportDXF3D,menuDXF3DKeyPos);	SetEuroKey(menuExportDXF2D,menuExportDXF2DEuroKey);	SetEuroKey(menuExportDXF3D,menuExportDXF3DEuroKey);	SetEuroKey(menuExportVoyager,menuExportPlayerEuroKey);	//need to change voyager to player			#if VRML_ANCHOR				// VRML-ABD 23JUN95	SetKeyPos(menuExportVRML,menuVRMLKeyPos);			// what does this mean??? fix this!!!!	SetEuroKey(menuExportVRML,menuExportVRMLEuroKey);	// what does this mean??? fix this!!!!	#endif // VRML_ANCHOR#endif //WINDOWS#if !VPRO	// MERGE-GOURAUD-PRO-11#if MACINTOSH	vFile = new(VoyagerFile);	vFile->cVoyagerFile();	vger = vFile->FindVoyager();	vFile->dFile();	if (vger == fileNotFoundErr)    	Activate(menuExportVoyager, FALSE);#endif //MACINTOSH#endif // !VPRO 	// MERGE-GOURAUD-PRO-11#else  //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	#if VRML_ANCHOR				// VRML-ABD 23JUN95	Append(TXTM_VRML);	SetKeyPos(menuExportVRML,menuVRMLKeyPos);			// what does this mean??? fix this!!!!	SetEuroKey(menuExportVRML,menuExportVRMLEuroKey);	// what does this mean??? fix this!!!!	#endif // VRML_ANCHOR#endif //SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	}#if !SAVE_DISABLED // jca 22Feb95#ifdef powercvoidMenuExport::Preempt()	{// PRO25// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#if !VPRO// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	Activate(menuExportDXF2D, FALSE);// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	Activate(menuExportDXF3D, FALSE);// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#endif	#if VRML_ANCHOR				// VRML-ABD 23JUN95	Activate(menuExportVRML, TRUE);	#endif // VRML_ANCHOR	}#endif //powerc#else // SAVE_DISABLED // jca 22Feb95voidMenuExport::Preempt()	{// PRO25// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#if !VPRO// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	Activate(menuExportDXF2D, FALSE);// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	Activate(menuExportDXF3D, FALSE);// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	Activate(menuExportVoyager, FALSE);// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#endif	#if VRML_ANCHOR				// VRML-ABD 23JUN95	Activate(menuExportVRML, FALSE);	#endif // VRML_ANCHOR	}#endif // !SAVE_DISABLED // jca 22Feb95voidMenuExport::Action(int num, long modifier)	{#if !SAVE_DISABLED // jca 22Feb95. No exports.	switch(num)		{		// PRO25	// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	#if SPECIAL_EDITION	// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!	// DO SPECIAL EDITION STUFF HERE	#endif	// PRO25 // WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DAMMIT!!!!!// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!! #ifdef powerc// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!		case menuExportDXF2D: break;// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!!		case menuExportDXF3D: break;// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!! #else		case menuExportDXF2D: pdc(((WalkDocumentStub *)document))->Import(export,format2DDXF);  break;		case menuExportDXF3D: pdc(((WalkDocumentStub *)document))->Import(export,format3DDXF); 	break;// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DXF DAMMIT!!!!! #endif //powerc #if MACINTOSH  #if !VPRO	// MERGE-GOURAUD-PRO-11 		case menuExportClarisCAD: pdc(((WalkDocumentStub *)document))->Import(export,formatClarisCAD);  break;		case menuExportMacDrawII: pdc(((WalkDocumentStub *)document))->Import(export,formatMacDraw);  break;  #endif 	// MERGE-GOURAUD-PRO-11   #if VPRO	// MERGE-GOURAUD-PRO-11 		case menuExportVoyager: pdc(((WalkDocumentStub *)document))->Import(export,formatPlayer); break;	// MERGE-GOURAUD-PRO-11  #else	// MERGE-GOURAUD-PRO-11		case menuExportVoyager: pdc(((WalkDocumentStub *)document))->Import(export,formatVoyager); break;  #endif	// MERGE-GOURAUD-PRO-11  #endif //MACINTOSH #if WINDOWS  #if VPRO		case menuExportVoyager: pdc(((WalkDocumentStub *)document))->Import(export,formatPlayer); break;	// MERGE-GOURAUD-PRO-11  #endif //VPRO #endif //WINDOWS// WHAT THE HELL IS THIS CRAP?????? ABD EXPORT DAMMIT!!!!!#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95 		#if VRML_ANCHOR				// VRML-ABD 23JUN95 		case menuExportVRML: 			 pdc(((WalkDocumentStub *)document))->Import(export,formatVRML); 			break; 		#endif // VRML_ANCHOR		}#endif // !SAVE_DISABLED // jca 22Feb95	}#endif //VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95#if (!VPLAYER)voidMenuSnapShot::ctheMenu(WalkDocumentStub *doc)	{		controller = NULL;		cMenu(TXTM_EXPORT,doc);#if MACINTOSH#if VWT#if !VPRO	// MERGE-GOURAUD-PRO-12	Append(TXTM_EPS);#endif // !VPRO		// MERGE-GOURAUD-PRO-12	#if !SPECIAL_EDITION			// ABD-VRML3	Append(TXTM_ILLUS);	#endif // SPECIAL_EDITION		// ABD-VRML3#endif //VWT	Append(TXTM_PICT);#if VWT	#if !SPECIAL_EDITION			// ABD-VRML3    Append(TXTM_TIFF);	#endif // SPECIAL_EDITION		// ABD-VRML3#endif //VWT	// MERGE-GOURAUD-PRO AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	// MERGE-GOURAUD-PRO Append(TXTM_PICS);	// MERGE-GOURAUD-PRO Append(TXTM_QTIME);	// MERGE-GOURAUD-PRO SetKeyPos(menuSShotPICS,menuPICSKeyPos);	// MERGE-GOURAUD-PRO SetKeyPos(menuSShotQTime,menuQTimeKeyPos);	#if VWT    #if !VPRO	SetEuroKey(menuSShotEPS, menuSShotEPSEuroKey);    #endif //!VPRO	#if !SPECIAL_EDITION	// ABD-VRML3	SetEuroKey(menuSShotIllus, menuSShotIllusEuroKey);	#endif // !SPECIAL_EDITION	// ABD-VRML3	#endif //VWT	SetEuroKey(menuSShotPICT, menuSShotPICTEuroKey);    #if VWT	#if !SPECIAL_EDITION	// ABD-VRML3	SetEuroKey(menuSShotTIFF, menuSShotTIFFEuroKey);	#endif // !SPECIAL_EDITION	// ABD-VRML3	#endif //VWT#elif WINDOWS	Append(TXTM_BMP);	SetEuroKey(menuSShotBMP, menuSShotBMPEuroKey);#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95#if !VPRO	// MERGE-GOURAUD-PRO-12	Append(TXTM_EPS);	SetEuroKey(menuSShotEPS, menuSShotEPSEuroKey);#endif // !VPRO		// MERGE-GOURAUD-PRO-12	Append(TXTM_ILLUS);	Append(TXTM_TIFF);	SetEuroKey(menuSShotIllus, menuSShotIllusEuroKey);	SetEuroKey(menuSShotTIFF, menuSShotTIFFEuroKey);#endif //VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95//	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93  // removed GJR 7/12/95	// MERGE-GOURAUD-PRO Append(TXTM_FLIC);	// MERGE-GOURAUD-PRO SetEuroKey(menuSShotFLIC, menuSShotFLICEuroKey);#if V_AVI	// MERGE-GOURAUD-PRO Append(TXTM_AVI);        // AVI will not be in VR, at least not immediately#endif // V_AVI#endif //WINDOWS#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95//	#if (!(WINDOWS))	//jam changed so windows doesn't have 2 separators	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93//	#endif	Append(TXTM_QSNAP);	SetKey(menuSShotQSnap, menuSShotQSnapKey);	SetEuroKey(menuSShotQSnap, menuSShotQSnapEuroKey);#endif //PRO || (VWT && !SPECIAL_EDITION)         	// merge SE, vrmadness		// GJR 7/4/95	}voidMenuSnapShot::SetController(WalkController *ctrl)	{		controller = ctrl;	}voidMenuSnapShot::Preempt()	{		int	length;	if(controller)length = controller->observer->path->ALength();	else length = 0;#if MACINTOSH	// MERGE-GOURAUD-PRO Activate(menuSShotPICS,(length) ? TRUE : FALSE);	// MERGE-GOURAUD-PRO Activate(menuSShotQTime,(gQuickTime&&length) ? TRUE : FALSE );#elif WINDOWS #if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	// MERGE-GOURAUD-PRO Activate(menuSShotFLIC,(length) ? TRUE : FALSE);  #if V_AVI	// MERGE-GOURAUD-PRO Activate(menuSShotAVI,(length) ? TRUE : FALSE);  #endif // V_AVI #endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95#endif //WINDOWS#if SAVE_DISABLED // jca 22Feb95 #if VWT  #if !VPRO // MERGE-GOURAUD-PRO-12		Activate(menuSShotEPS, FALSE);  #endif // MERGE-GOURAUD-PRO-12		Activate(menuSShotIllus, FALSE);		Activate(menuSShotTIFF, FALSE); #endif //VWT #if MACINTOSH		Activate(menuSShotPICT, FALSE); #elif WINDOWS		Activate(menuSShotBMP, FALSE); #endif //WINDOWS 		Activate(menuSShotQSnap, FALSE);#endif // SAVE_DISABLED // jca 22Feb95	}	// MERGE-GOURAUD-PRO removed movie-related items from belowvoidMenuSnapShot::Action(int num, long modifier)	{#if !SAVE_DISABLED // jca 22Feb95	switch(num)		{#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95 #if !VPRO // MERGE-GOURAUD-PRO-12		case menuSShotEPS: pdc(((WalkDocumentStub *)document))->Import(export,formatEPS); 		break; #endif // MERGE-GOURAUD-PRO-12		case menuSShotIllus: pdc(((WalkDocumentStub *)document))->Import(export,formatIllustrator); break;		case menuSShotTIFF: pdc(((WalkDocumentStub *)document))->Import(export,formatTIFF);		break;#endif //VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95#if MACINTOSH		case menuSShotPICT: pdc(((WalkDocumentStub *)document))->Import(export,formatPICT); 		break;#elif WINDOWS		case menuSShotBMP: pdc(((WalkDocumentStub *)document))->Import(export,formatBMP);			break;#if V_AVI#endif //V_AVI#endif //WINDOWS#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95		case menuSShotQSnap: pdc(((WalkDocumentStub *)document))->Import(export,formatSameSnap); break;#endif //VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95		}#endif // !SAVE_DISABLED // jca 22Feb95	}#endif //!VPLAYER#if VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95voidMenuPlace::ctheMenu(WalkDocumentStub *doc)	{		cMenu(TXTM_PLACE,doc);#if MACINTOSH// MERGE-GOURAUD-PRO-7	Append(TXTM_CLARISCAD);// MERGE-GOURAUD-PRO-7	Append(TXTM_MACDRAWII);	Append(TXTM_PICT);    Append(TXTM_DXF2D);	// MERGE-GOURAUD-PRO-7    Append(TXTM_TIFF);	SetEuroKey(menuPlacePICT, menuPlacePICTEuroKey);	SetEuroKey(menuPlaceDXF2D, menuPlaceDXF2DEuroKey);	SetEuroKey(menuPlaceTIFF, menuPlaceTIFFEuroKey);#elif WINDOWS	Append(TXTM_BMP);    Append(TXTM_DXF2D);	Append(TXTM_TIFF);	SetKeyPos(menuPlaceDXF2D,menuDXF2DKeyPos);	SetEuroKey(menuPlaceBMP, menuPlaceBMPEuroKey);	SetEuroKey(menuPlaceDXF2D, menuPlaceDXF2DEuroKey);	SetEuroKey(menuPlaceTIFF, menuPlaceTIFFEuroKey);#endif //WINDOWS	}#ifdef powercvoidMenuPlace::Preempt()	{// WHAT THE HELL IS THIS CRAP???? ABD WHY AREN'T WE DOING DXF DAMMMIT???????????     Activate(menuPlaceDXF2D, FALSE);    }#endif //powercvoidMenuPlace::Action(int num, long modifier)	{	switch(num)		{		case menuPlaceTIFF: pdc(((WalkDocumentStub *)document))->Import(place,formatTIFF); break;		// MERGE-GOURAUD-PRO-7 moved line from windows case to here// WHAT THE HELL IS THIS CRAP???? ABD WHY AREN'T WE DOING DXF DAMMMIT??????????? #ifdef powerc// WHAT THE HELL IS THIS CRAP???? ABD WHY AREN'T WE DOING DXF DAMMMIT??????????? 		case menuPlaceDXF2D: break;// WHAT THE HELL IS THIS CRAP???? ABD WHY AREN'T WE DOING DXF DAMMMIT??????????? #else		case menuPlaceDXF2D: pdc(((WalkDocumentStub *)document))->Import(place,format2DDXF); break;// WHAT THE HELL IS THIS CRAP???? ABD WHY AREN'T WE DOING DXF DAMMMIT??????????? #endif //powerc#if MACINTOSH	// MERGE-GOURAUD-PRO-7	case menuPlaceClarisCAD:  pdc(((WalkDocumentStub *)document))->Import(place,formatClarisCAD); break;	// MERGE-GOURAUD-PRO-7	case menuPlaceMacDrawII: pdc(((WalkDocumentStub *)document))->Import(place,formatMacDraw); break;		case menuPlacePICT: pdc(((WalkDocumentStub *)document))->Import(place,formatPICT); break;#elif WINDOWS		case menuPlaceBMP: pdc(((WalkDocumentStub *)document))->Import(place,formatBMP); break;#endif //WINDOWS		}	}#endif //VWT && !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95voidMenuEdit::ctheMenu(V_Document *doc)	{	controller = NULL;		cMenu(TXTM_EDIT,doc);	SetMenuEuroKey(menuEditEuroKey);#if VPLAYER	Append(TXTM_UNDO);	AppendSeparator();	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);#else#if VWT	Append(TXTM_UNDO);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_DUPLICATE);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#elif VR	Append(TXTM_UNDO);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);	Append(TXTM_SELALL);	Append(TXTM_UNSELALL);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_DUPLICATE);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_GROUP);	Append(TXTM_UNGROUP);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#endif //VR	Append(TXTM_PREFERENCE);#endif // VPLAYER	SetPriority(editPriority);		SetKey(menuUndo, menuUndoKey);	SetKey(menuCut, menuCutKey);	SetKey(menuCopy, menuCopyKey);	SetKey(menuPaste, menuPasteKey);#if (!VPLAYER)	SetKey(menuDuplicate, menuDuplicateKey);	SetKey(menuClear, menuClearKey);#if VWT	SetKey(menuStubPreferences, menuPreferencesKey);	SetKeyPos(menuStubPreferences, menuPreferencesKeyPos);#elif VR	SetKey(menuVRGroup, menuVRGroupKey);	#if WINDOWS	SetKey(menuVRUngroup, menuVRUngroupKey);	#if SPANISH	   SetKeyPos(menuVRUngroup, menuVRUngroupKeyPos);	#endif // SPANISH	#endif //WINDOWS#endif //VWT#endif //!VPLAYER#if GERMAN	SetKeyPos(menuCut, menuCutKeyPos);#elif SPANISH	SetKeyPos(menuCut, menuCutKeyPos);	SetKeyPos(menuClear, menuClearKeyPos);#else // English default	SetKeyPos(menuCut, menuCutKeyPos);	SetKeyPos(menuClear, menuClearKeyPos);#endif // GERMAN	SetEuroKey(menuUndo, menuUndoEuroKey);	SetEuroKey(menuCut, menuCutEuroKey);	SetEuroKey(menuCopy, menuCopyEuroKey);	SetEuroKey(menuPaste, menuPasteEuroKey);	SetEuroKey(menuClear, menuClearEuroKey);#if (!VPLAYER)	SetEuroKey(menuDuplicate, menuDuplicateEuroKey);#if VWT	SetEuroKey(menuStubPreferences, menuPreferencesEuroKey);#elif VR	SetEuroKey(menuSelectAll, menuSelectAllEuroKey);	SetEuroKey(menuDeselectAll, menuDeselectAllEuroKey);	SetEuroKey(menuVRGroup, menuVRGroupEuroKey);	SetEuroKey(menuVRUngroup, menuVRUngroupEuroKey);	SetEuroKey(menuPreferences, menuPreferencesEuroKey);#endif //VR#endif //VPLAYER	}voidMenuEdit::SetController(WalkController *ctrl)	{	controller = ctrl;	}voidMenuEdit::Preempt()	{#if VPLAYER	Activate(menuUndo, FALSE); 	Activate(menuCut, FALSE);	Activate(menuCopy, FALSE);	Activate(menuPaste, FALSE);	Activate(menuPaste+1, FALSE);#else	Controller	*ctrl;	int	state,ctrlType;    int pasteOk, selectOk;		if(!controller)		ctrlType = toolCRTLWalkStub;	else		{		ctrl = controller->GetFrontController();		ctrlType = ctrl->GetType();		}		switch(ctrlType)		{		case toolCRTLView: 		case toolCRTLLibrary:						state = TRUE; 			break;						default: state = FALSE; break;			}	if (ctrlType != toolCRTLWalkStub)		{// jca 24MAR94 do we have anything selected, and do we have anything we could paste?        VSetCursor(vCursorArrow); // I/O from clipboard in CanBufferPaste() would show wait cursor. Don't.		selectOk = ctrl->IsAnythingSelected();		pasteOk = ctrl->CanBufferPaste(clipBuf);		}	else		{ // no edit menu stuff on in stub        selectOk = pasteOk = 0;        }	Activate(menuUndo, FALSE);#if SAVE_DISABLED		// ABD-SAVE-DISABLED	if (ctrlType == toolCRTLLibrary)		Activate(menuCut, FALSE );	else		Activate(menuCut, (state && selectOk) );#else	Activate(menuCut, (state && selectOk) );#endif	Activate(menuCopy, (state && selectOk) );#if SAVE_DISABLED		// ABD-SAVE-DISABLED	if (ctrlType == toolCRTLLibrary)		Activate(menuClear, FALSE );	else		Activate(menuClear, (state && selectOk) );#else	Activate(menuClear, (state && selectOk) );#endif	Activate(menuClear, (state && selectOk) );#if SAVE_DISABLED		// ABD-SAVE-DISABLED	if (ctrlType == toolCRTLLibrary)		Activate(menuDuplicate, FALSE );	else		Activate(menuDuplicate, (state && selectOk) );#else	Activate(menuDuplicate, (state && selectOk) );#endif#if SAVE_DISABLED		// ABD-SAVE-DISABLED	if (ctrlType == toolCRTLLibrary)		Activate(menuPaste, FALSE );	else		Activate(menuPaste, (state && pasteOk) );#else	Activate(menuPaste, (state && pasteOk) );#endif#if VWT	Activate(menuStubPreferences, (controller!=NULL));#elif VR	Activate(menuSelectAll, state);	Activate(menuDeselectAll, state);	Activate(menuVRGroup, state);	Activate(menuVRUngroup, state); 	Activate(menuPreferences, (controller!=NULL));#endif //VWT#endif //VPLAYER	}voidMenuEdit::Action(int num, long modifier)	{	#if (!VPLAYER)	switch (num)		{		case menuUndo: VSendMessage(MSG_UNDO); break;		case menuCut: VSendMessage(MSG_CUT); break;		case menuCopy: VSendMessage(MSG_COPY); break;		case menuClear: VSendMessage(MSG_CLEAR); break;		case menuDuplicate: VSendMessage(MSG_DUPLICATE); break;			case menuPaste: VSendMessage(MSG_PASTE); break;	#if VWT		case menuStubPreferences: ((WalkDocumentStub *)document)->Preferences(); break;#elif VR		case menuSelectAll: if(!(modifier&V_SHIFT)) { VSendMessage(MSG_SELECTALL); break; }		case menuDeselectAll: VSendMessage(MSG_DESELECTALL); break;		case menuVRGroup:if(!(modifier&V_SHIFT)) { VSendMessage(MSG_GROUP); break; }		case menuVRUngroup: VSendMessage(MSG_UNGROUP); break;		case menuPreferences: ((WalkDocumentStub *)document)->Preferences(); break;#endif //VWT		}#endif //!VPLAYER	}voidMenuWalkEdit::ctheMenu(V_Document *doc)	{	cMenu(TXTM_EDIT,doc);	SetMenuEuroKey(menuEditEuroKey);#if VPLAYER	Append(TXTM_UNDO);	AppendSeparator();	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);#else#if VWT	Append(TXTM_UNDO);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_DUPLICATE);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_MODIFY);	Append(TXTM_SELALL);	Append(TXTM_UNSELALL);	Append(TXTM_HIDESEL);	Append(TXTM_SHOWALL);	Append(TXTM_LOCKSEL);	Append(TXTM_UNLOCKALL);#elif VR	Append(TXTM_UNDO);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_CUT);	Append(TXTM_COPY);	Append(TXTM_PASTE);	Append(TXTM_CLEAR);	Append(TXTM_SELALL);	Append(TXTM_UNSELALL);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_DUPLICATE);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_GROUP);	Append(TXTM_UNGROUP);#endif //VWT	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_PREFERENCE);#endif //VPLAYER	SetPriority(editPriority);	#if VWT	convert = new(MenuConvert);	convert->ctheMenu((WalkDocumentStub*)doc);	SetHeir(menuConvert,convert);#endif //VWT	SetKey(menuUndo, menuUndoKey);	SetKey(menuCut, menuCutKey);	SetKey(menuCopy, menuCopyKey);	SetKey(menuPaste, menuPasteKey);#if (!VPLAYER)	SetKey(menuClear, menuClearKey);	SetKey(menuDuplicate, menuDuplicateKey);	SetKey(menuSelectAll, menuSelectAllKey);	#if GERMAN	  SetKeyPos(menuCut, menuCutKeyPos);	  SetKeyPos(menuDeselectAll, menuDeselectAllKeyPos);	  #if VPRO		  SetKeyPos(menuLockSelected, menuLockSelectedKeyPos);	  #endif //VPRO	#elif SPANISH	  SetKeyPos(menuDuplicate, menuDuplicateKeyPos);	  SetKeyPos(menuCut, menuCutKeyPos);	  SetKeyPos(menuClear, menuClearKeyPos);	  SetKeyPos(menuDeselectAll, menuDeselectAllKeyPos);	  #if VPRO		  SetKeyPos(menuLockSelected, menuLockSelectedKeyPos);	  #endif //VPRO	#else // English default	  SetKeyPos(menuCut, menuCutKeyPos);	  SetKeyPos(menuClear, menuClearKeyPos);	  SetKeyPos(menuDeselectAll, menuDeselectAllKeyPos);   	#endif // GERMAN#if VWT	SetKey(menuDeselectAll, menuDeselectAllKey);	SetKey(menuHideSelected, menuHideSelectedKey);    SetKey(menuShowAll, menuShowAllKey);	SetKey(menuLockSelected, menuLockSelectedKey);    SetKey(menuUnlockAll, menuUnlockAllKey);	SetKey(menuPreferences, menuPreferencesKey);#elif VR	SetKey(menuVRGroup, menuVRGroupKey);	#if WINDOWS	SetKey(menuVRUngroup, menuVRUngroupKey);	#endif //WINDOWS#endif //VWT#if VWT  #if GERMAN   	SetKeyPos(menuShowAll, menuShowAllKeyPos);	SetKeyPos(menuUnlockAll, menuUnlockAllKeyPos);	SetKeyPos(menuPreferences, menuPreferencesKeyPos);	SetKeyPos(menuDeselectAll, menuDeselectAllKeyPos);	SetKeyPos(menuHideSelected, menuHideSelectedKeyPos);  #elif SPANISH	SetKeyPos(menuShowAll, menuShowAllKeyPos);	SetKeyPos(menuUnlockAll, menuUnlockAllKeyPos);	SetKeyPos(menuPreferences, menuPreferencesKeyPos);  #else // English default	SetKeyPos(menuShowAll, menuShowAllKeyPos);	SetKeyPos(menuUnlockAll, menuUnlockAllKeyPos);	SetKeyPos(menuPreferences, menuPreferencesKeyPos);  #endif // GERMAN#elif VR  	SetKeyPos(menuPreferences, menuPreferencesKeyPos);      // VR and VPRO#endif // VWT#endif //!VPLAYER	SetEuroKey(menuUndo, menuUndoEuroKey);	SetEuroKey(menuCut, menuCutEuroKey);	SetEuroKey(menuCopy, menuCopyEuroKey);	SetEuroKey(menuPaste, menuPasteEuroKey);	SetEuroKey(menuClear, menuClearEuroKey);#if (!VPLAYER)	SetEuroKey(menuDuplicate, menuDuplicateEuroKey);	SetEuroKey(menuSelectAll, menuSelectAllEuroKey);	SetEuroKey(menuDeselectAll, menuDeselectAllEuroKey);#if VPRO	SetEuroKey(menuHideSelected, menuHideSelectedEuroKey);	SetEuroKey(menuShowAll, menuShowAllEuroKey);	SetEuroKey(menuLockSelected, menuLockSelectedEuroKey);	SetEuroKey(menuUnlockAll, menuUnlockAllEuroKey);	SetEuroKey(menuConvert, menuConvertEuroKey);#endif#if VR	SetEuroKey(menuVRGroup, menuVRGroupEuroKey);	SetEuroKey(menuVRUngroup, menuVRUngroupEuroKey);#endif //VR	SetEuroKey(menuPreferences, menuPreferencesEuroKey);#endif //VPLAYER	}voidMenuWalkEdit::SetController(WalkController *ctrl)	{	MenuEdit::SetController(ctrl);#if VWT	convert->SetController(controller);		#endif //VWT	}	voidMenuWalkEdit::Preempt()	{#if VPLAYER	Activate(menuUndo, FALSE); 	Activate(menuCut, FALSE);	Activate(menuCopy, FALSE);	Activate(menuPaste, FALSE);	Activate(menuPaste+1, FALSE);#else	Controller		*ctrl;	EditSpecList	*undoItem;	int	editState,undoState,convertState,hideState,selectState,groupState,ctrlType,undoType;	int selectOk, pasteOk;	groupState = FALSE;	ctrl = controller->GetFrontController();	ctrlType = ctrl->GetType();		undoItem = UndoItem();	undoType = undoItem->GetType();		switch(ctrlType)		{		case toolCRTLDesign:undoState = (undoType&(UNDO_POLY_FLAG|UNDO_CAD_FLAG)) ? TRUE : FALSE; break;		case toolCRTTumble: undoState = (undoType&(UNDO_POLY_FLAG|UNDO_SURF_FLAG|UNDO_CAD_FLAG)) ? TRUE : FALSE; break;		case toolCRTLSurface:undoState = (undoType&(UNDO_SURF_FLAG|UNDO_CAD_FLAG)) ? TRUE : FALSE; break;		default: undoState = FALSE;  break;		}	switch(ctrlType)		{		case	toolCRTLView:		case toolCRTLLibrary:			editState = FALSE;			convertState = FALSE;			selectState = FALSE;			hideState = FALSE;			break;						case 	toolCRTLWalk:		case 	toolCRTLWalkStub: 			editState = FALSE;			convertState = FALSE;			hideState = FALSE;			selectState = FALSE;			break;		case	toolCRTLDesign:			convertState = FALSE;			editState = TRUE; 			hideState = TRUE;			selectState = TRUE;			groupState = TRUE;			break;		case	toolCRTLSurface:			convertState = TRUE;			editState = TRUE; 			hideState = TRUE;			selectState = TRUE;			break;		case	toolCRTTumble:			convertState = TRUE;  // FALSE; jca 28MAR94 you can change the color, opacity/translucency/transparency of the base object			editState = TRUE; 			hideState = FALSE;			selectState = FALSE; // TRUE; jca 25MAR94 TRUE makes no sense			break;					case 	toolCRTLLight:		default:			convertState = FALSE;			editState = TRUE; 			hideState = FALSE;			selectState = FALSE;			break;		}	// jca 24MAR94 do we have anything selected, and do we have anything we could paste?	VSetCursor(vCursorArrow); // I/O from clipboard in CanBufferPaste() would show wait cursor. Don't.	selectOk = ctrl->IsAnythingSelected();	pasteOk = ctrl->CanBufferPaste(clipBuf);	Activate(menuUndo, undoState);	Activate(menuCut, (editState && selectOk) );	Activate(menuCopy, (editState && selectOk) );	Activate(menuClear, (editState && selectOk) );	Activate(menuDuplicate, (editState && selectOk) );	Activate(menuPaste, (editState && pasteOk) );	Activate(menuSelectAll, selectState);	Activate(menuDeselectAll, (selectState && selectOk) );	Activate(menuPreferences, (controller!=NULL));#if VWT	Activate(menuConvert, (convertState || selectOk) );	// jca enable menu sometimes even if nothing is selected	Activate(menuHideSelected, (hideState && selectOk) );	Activate(menuShowAll, hideState);	Activate(menuLockSelected, (hideState && selectOk) );	Activate(menuUnlockAll, hideState);#elif VR	Activate(menuVRGroup, groupState);	Activate(menuVRUngroup, groupState); #endif //VWT#endif //VPLAYER	}			/*========================================================================= * void MenuWalkEdit::Action(int num, long modifier) *-------------------------------------------------------------------------*/voidMenuWalkEdit::Action(int num, long modifier)	{	#if (!VPLAYER)	switch (num)		{		case menuUndo: VSendMessage(MSG_UNDO); break;		case menuCut: VSendMessage(MSG_CUT); break;		case menuCopy: VSendMessage(MSG_COPY); break;		case menuDuplicate: VSendMessage(MSG_DUPLICATE); break;			case menuPaste: VSendMessage(MSG_PASTE); break;			case menuClear: VSendMessage(MSG_CLEAR); break;		case menuSelectAll: if(!(modifier&V_SHIFT)) { VSendMessage(MSG_SELECTALL); break; }		case menuDeselectAll: VSendMessage(MSG_DESELECTALL); break;#if VWT		case menuHideSelected: if(!(modifier&V_SHIFT)) { VSendMessage(MSG_HIDEALL); break; }		case menuShowAll: VSendMessage(MSG_SHOWALL); break;			case menuLockSelected:  if(!(modifier&V_SHIFT)) { VSendMessage(MSG_LOCKSEL);break; }		case menuUnlockAll: VSendMessage(MSG_UNLOCKALL); break; #elif VR		case menuVRGroup:if(!(modifier&V_SHIFT)) { VSendMessage(MSG_GROUP); break; }		case menuVRUngroup: VSendMessage(MSG_UNGROUP); break;#endif //VWT		case menuPreferences: ((WalkDocumentStub *)document)->Preferences(); break;		}#endif //!VPLAYER	}	#if VWT/*========================================================================= * void MenuConvert::ctheMenu(WalkDocumentStub *doc) *-------------------------------------------------------------------------*/voidMenuConvert::ctheMenu(WalkDocumentStub *doc)	{	cMenu(TXTM_MODIFY,doc);	Append(TXTM_UNROTATE);		Append(TXTM_UNSCALE);		Append(TXTM_UNSKEW);		AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_COLOR);		Append(TXTM_TRANSOPQ);		Append(TXTM_TRANSLUC);		Append(TXTM_TRANSPAR);		AppendSeparator();				// MERGE-GOURAUD#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Append(TXTM_FLAT_SHADING);		// MERGE-GOURAUD	Append(TXTM_GOURAUD_SHADING);	// MERGE-GOURAUD	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	SetEuroKey(menuFlatShaded, menuFlatShadedEuroKey);	SetEuroKey(menuGouraudShaded, menuGouraudShadedEuroKey);#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	Append(TXTM_SINGLE);	Append(TXTM_DOUBLE);	Append(TXTM_FLIP);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93		Append(TXTM_EXTRUDE);	Append(TXTM_CONVERGE);	Append(TXTM_ELLIPSE);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_SIDES);	Append(TXTM_LEVELS);	#if GERMAN		SetKeyPos(menuUnScale,menuUnScaleKeyPos);		SetKeyPos(menuUnSkew,menuUnSkewKeyPos);		SetKeyPos(menuSingle,menuSingleKeyPos);		SetKeyPos(menuDouble,menuDoubleKeyPos);		SetKeyPos(menuFlip,menuFlipKeyPos);		SetKeyPos(menuStraight, menuStraightKeyPos);		SetKeyPos(menuPointed,menuPointedKeyPos);		SetKeyPos(menuNumLevels,menuNumLevelsKeyPos);   	#elif SPANISH		SetKeyPos(menuUnScale,menuUnScaleKeyPos);		SetKeyPos(menuUnSkew,menuUnSkewKeyPos);		SetKeyPos(menuTranslucent,menuTranslucentKeyPos);		SetKeyPos(menuSingle,menuSingleKeyPos);		SetKeyPos(menuNumSides,menuNumSidesKeyPos);		SetKeyPos(menuNumLevels,menuNumLevelsKeyPos);		SetKeyPos(menuDouble,menuDoubleKeyPos);		SetKeyPos(menuFlip,menuFlipKeyPos);		SetKeyPos(menuPointed,menuPointedKeyPos);		SetKeyPos(menuRounded,menuRoundedKeyPos);		SetKeyPos(menuFlatShaded,menuFlatShadeKeyPos);		SetKeyPos(menuGouraudShaded,menuSmoothShadeKeyPos);	#else // ENGLISH default		SetKeyPos(menuFlatShaded,menuFlatShadeKeyPos);		SetKeyPos(menuGouraudShaded,menuSmoothShadeKeyPos);        SetKeyPos(menuUnScale,menuUnScaleKeyPos);		SetKeyPos(menuUnSkew,menuUnSkewKeyPos);		SetKeyPos(menuTranslucent,menuTranslucentKeyPos);		SetKeyPos(menuSingle,menuSingleKeyPos);		SetKeyPos(menuNumSides,menuNumSidesKeyPos);		SetKeyPos(menuNumLevels,menuNumLevelsKeyPos);    #endif //GERMAN	SetEuroKey(menuUnRotate, menuUnRotateEuroKey);	SetEuroKey(menuUnScale, menuUnScaleEuroKey);	SetEuroKey(menuUnSkew, menuUnSkewEuroKey);	SetEuroKey(menuColor, menuColorEuroKey);	SetEuroKey(menuOpaque, menuOpaqueEuroKey);	SetEuroKey(menuTranslucent, menuTranslucentEuroKey);	SetEuroKey(menuTransparent, menuTransparentEuroKey);	SetEuroKey(menuSingle, menuSingleEuroKey);	SetEuroKey(menuDouble, menuDoubleEuroKey);	SetEuroKey(menuFlip, menuFlipEuroKey);	SetEuroKey(menuStraight, menuStraightEuroKey);	SetEuroKey(menuPointed, menuPointedEuroKey);	SetEuroKey(menuRounded, menuRoundedEuroKey);	SetEuroKey(menuNumSides, menuNumSidesEuroKey);	SetEuroKey(menuNumLevels, menuNumLevelsEuroKey);	}voidMenuConvert::SetController(WalkController *ctrl)	{	controller = ctrl;	}voidMenuConvert::Preempt()	{	Controller *ctrl;	int	design,editor,rotate,ctrlType;	int selectOk, singleE, doubleE;	ULong conditions;	ctrl = controller->GetFrontController();	ctrlType = ctrl->GetType();	switch(ctrlType)		{		case 	toolCRTLWalk:			case	toolCRTLView: 			case 	toolCRTLLibrary:		case 	toolCRTLLight:	editor = design = rotate = FALSE; 		break;		case	toolCRTLDesign:	editor = design = rotate = TRUE; 		break;		case	toolCRTTumble:	editor = TRUE; design = rotate = FALSE; break;		case	toolCRTLSurface:editor = rotate = TRUE; design = FALSE; break;		}	// jca 24MAR94 add some more flags for preemting	selectOk = ctrl->IsAnythingSelected();	conditions = ctrl->SelectedConditions();	singleE = conditions & SELECTED_DOUBLE;   // yes, double	doubleE = conditions & SELECTED_SINGLE;   // yes, single	Activate(menuUnRotate, rotate && (conditions & SELECTED_ROTATED));	Activate(menuUnScale, rotate && (conditions & SELECTED_SCALED));	Activate(menuUnSkew, design && (conditions & SELECTED_SKEWED));	Activate(menuOpaque, (editor && (!(conditions & SELECTED_OPAQUE))));	Activate(menuTranslucent, (editor && (!(conditions & SELECTED_TRANSLUCENT))));	Activate(menuTransparent, (editor && (!(conditions & SELECTED_TRANSPARENT))));	#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95	Activate(menuFlatShaded, editor);		// MERGE-GOURAUD	Activate(menuGouraudShaded, editor);	// MERGE-GOURAUD#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95	Activate(menuSingle, design && singleE);	Activate(menuDouble, design && doubleE);	Activate(menuFlip, design && (doubleE || singleE));	Activate(menuStraight, design && (!(conditions & SELECTED_STRAIGHT)));	Activate(menuPointed, design && (!(conditions & SELECTED_POINTED)));	Activate(menuRounded, design && (!(conditions & SELECTED_ROUNDED)));	Activate(menuNumSides, (rotate && (conditions & SELECTED_SIDES)));	Activate(menuNumLevels, (design && (conditions & SELECTED_LEVELS)));	}/*========================================================================= * void MenuConvert::Action(int num, long modifier) *-------------------------------------------------------------------------*/voidMenuConvert::Action(int num, long modifier)	{	switch(num)		{		case menuUnRotate: VSendMessage(MSG_UNROTATE); break;			case menuUnScale: VSendMessage(MSG_UNSCALE); break;			case menuUnSkew: VSendMessage(MSG_UNSKEW); break;			case menuColor:  if(V_OPTION&modifier)VSendMessage(MSG_COLOR); VSendMessage(MSG_COLORPOP);break;			case menuOpaque: VSendMessage(MSG_OPAQUE); break;			case menuTranslucent: VSendMessage(MSG_TRANSLUCENT); break;			case menuTransparent: VSendMessage(MSG_TRANSPARENT); break;	#if !SPECIAL_EDITION         	// merge SE, vrmadness		// GJR 7/4/95		case menuFlatShaded: VSendMessage(MSG_FLAT_SHADED); break;		case menuGouraudShaded: VSendMessage(MSG_GOURAUD_SHADED); break;#endif //!SPECIAL_EDITION		// merge SE, vrmadness		// GJR 7/4/95		case menuFlip:		VSendMessage(MSG_FLIP); break;		case menuSingle:	VSendMessage(MSG_SINGLE); break;			case menuDouble:	VSendMessage(MSG_DOUBLE); break;			case menuStraight: 	VSendMessage(MSG_EXTRUDE); break;			case menuPointed:	VSendMessage(MSG_CONVERGE); break;			case menuRounded:	VSendMessage(MSG_ELLIPSE); break;			case menuNumSides:	VSendMessage(MSG_SIDES); break;			case menuNumLevels:	VSendMessage(MSG_LEVELS); break;			}	}#endif //VWTint gGouraud = TRUE;			// MERGE-GOURAUD DEBUG int gUseFastGouraud = TRUE;		// MERGE-GOURAUD DEBUG #if VRvoidMenuVRWalk::ctheMenu(V_Document *doc)	{	cMenu(TXTM_WALK,doc);#if !VPLAYER && !SPANISH	SetMenuKeyPos(menuWalkKeyPos);      // jca 2 Nov 93 add mnemonic#endif //!VPLAYER//#if SPANISH//	SetMenuKeyPos(menuWindowKeyPos);//#endif // SPANISH	SetMenuEuroKey(menuWalkEuroKey);	Append(TXTM_LEVELVIEW);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_WANGLE);	Append(TXTM_NANGLE);	Append(TXTM_TELEFOTO);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_RBEST);	Append(TXTM_RBETTER);	Append(TXTM_RFAST);	Append(TXTM_RFASTEST);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93#if VPLAYER	Append(TXTM_VCRSTOP);	Append(TXTM_VCRPLAY);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_FULLSCR);	state = 0;#else	Append(TXTM_VCRSTOP);	Append(TXTM_VCRPLAY);	Append(TXTM_VCRRECORD);	AppendSeparator();		// ABD WILLIAMS MERGE11 9/11/93	Append(TXTM_SKYCOLOR);#endif //VPLAYER	SetPriority(averagePriority);	SetKey(menuLevelVRObserver, menuLevelVRObserverKey);	#if SPANISH		SetKeyPos(menuRFastest, menuRFastestKeyPos);		SetKeyPos(menuVRStop, menuVRStopKeyPos);		SetKeyPos(menuVRPlay, menuVRPlayKeyPos);		SetKeyPos(menuVRRecord, menuVRRecordKeyPos);	#else // English default		SetKeyPos(menuRFast, menuRFastKeyPos);          	// jca 2 Nov 93 add mnemonics {		SetKeyPos(menuRFastest, menuRFastestKeyPos);		SetKeyPos(menuVRStop, menuStopKeyPos);    #endif // SPANISH#if VPLAYER	SetKeyPos(menuVPlayFullScr, menuVFullScrKeyPos);#else	#if !SPANISH    	SetKeyPos(menuSkyColor, menuSkyColorKeyPos);       // jca 2 Nov 93 add mnemonics }	#endif // !SPANISH   	recording = FALSE;#endif //!VPLAYER	SetEuroKey(menuLevelVRObserver, menuLevelVRObserverEuroKey);	SetEuroKey(menuWAngle, menuWAngleEuroKey);	SetEuroKey(menuNAngle, menuNAngleEuroKey);	SetEuroKey(menuTelefoto, menuTelefotoEuroKey);	SetEuroKey(menuRBest, menuRBestEuroKey);	SetEuroKey(menuRBetter, menuRBetterEuroKey);	SetEuroKey(menuRFast, menuRFastEuroKey);	SetEuroKey(menuRFastest, menuRFastestEuroKey);	SetEuroKey(menuVRStop, menuStopEuroKey);	SetEuroKey(menuVRPlay, menuPlayEuroKey);#if VPLAYER	SetEuroKey(menuVPlayFullScr, menuVFullScrEuroKey);#else	SetEuroKey(menuVRRecord, menuRecordEuroKey);    SetEuroKey(menuSkyColor, menuSkyColorEuroKey);#endif //VPLAYER	}void#if VPLAYERMenuVRWalk::SetController(WalkController *ctrl)#elseMenuVRWalk::SetController(CAVWalkController *ctrl)#endif //VPLAYER	{	controller = ctrl;	}voidMenuVRWalk::Action(int num, long modifier)	{		AppPreference		*appPref;	NavigatePreference	*navPref;	RenderPreference	*renderPref;	ModelPreference		*modelPref;	RGBColor			skyColor;	appPref = controller->GetPreference();	switch(num)		{											case menuLevelVRObserver: VSendMessage(MSG_RESETTILT); break;		case menuWAngle:			Select(menuWAngle, TRUE);			Select(menuNAngle, FALSE);			Select(menuTelefoto, FALSE);			navPref = (NavigatePreference*)appPref->GetPreference(preferNavigate);			navPref->focalLength = 15;				navPref->SetChange(TRUE);			controller->Request(NULL, msgReset, objView, 0);			navPref->SetChange(FALSE);			break;		case menuNAngle:			Select(menuWAngle, FALSE);			Select(menuNAngle, TRUE);			Select(menuTelefoto, FALSE);			navPref = (NavigatePreference*)appPref->GetPreference(preferNavigate);			navPref->focalLength = 35;				navPref->SetChange(TRUE);			controller->Request(NULL, msgReset, objView, 0);			navPref->SetChange(FALSE);			break;		case menuTelefoto:			Select(menuWAngle, FALSE);			Select(menuNAngle, FALSE);			Select(menuTelefoto, TRUE);			navPref = (NavigatePreference*)appPref->GetPreference(preferNavigate);			navPref->focalLength = 135;				navPref->SetChange(TRUE);			controller->Request(NULL, msgReset, objView, 0);			navPref->SetChange(FALSE);			break;		case menuRBest: //BILBIL this is the same as better right now!			renderPref = (RenderPreference*)appPref->GetPreference(preferRenderer);			Select(menuRBest, TRUE);			Select(menuRBetter, FALSE);			Select(menuRFast, FALSE);			Select(menuRFastest, FALSE);			renderPref->renderDrawMode = RENDER_FILL|RENDER_FRAME;			renderPref->renderOpenMode = RENDER_SEEIN|RENDER_SEEOUT|RENDER_SEECONN;			renderPref->SetChange(TRUE);			controller->Request(NULL,msgReset,objDefaults,0);			break;		case menuRBetter:			renderPref = (RenderPreference*)appPref->GetPreference(preferRenderer);			Select(menuRBest, FALSE);			Select(menuRBetter, TRUE);			Select(menuRFast, FALSE);			Select(menuRFastest, FALSE);			renderPref->renderDrawMode = RENDER_FILL|RENDER_FRAME|RENDER_NOTEXTURES;			renderPref->renderOpenMode = RENDER_SEEIN|RENDER_SEEOUT|RENDER_SEECONN;			renderPref->SetChange(TRUE);			controller->Request(NULL,msgReset,objDefaults,0);			break;		case menuRFast:			renderPref = (RenderPreference*)appPref->GetPreference(preferRenderer);			Select(menuRBest, FALSE);			Select(menuRBetter, FALSE);			Select(menuRFast, TRUE);			Select(menuRFastest, FALSE);			renderPref->renderDrawMode = RENDER_FILL|RENDER_FRAME|RENDER_NOTEXTURES;			renderPref->renderOpenMode = RENDER_SEECONN;			renderPref->SetChange(TRUE);			controller->Request(NULL,msgReset,objDefaults,0);			break;		case menuRFastest:			renderPref = (RenderPreference*)appPref->GetPreference(preferRenderer);			Select(menuRBest, FALSE);			Select(menuRBetter, FALSE);			Select(menuRFast, FALSE);			Select(menuRFastest, TRUE);			renderPref->renderDrawMode = RENDER_FRAME|RENDER_NOTEXTURES;			renderPref->renderOpenMode = 0;			renderPref->SetChange(TRUE);			controller->Request(NULL,msgReset,objDefaults,0);			break;#if VPLAYER		case menuVRStop:			{			WalkBPane*	thePane;						thePane = ((ViewController*)(controller->FindController(toolCRTLView)))->walkBPane;			if (thePane->theWindow)				{				thePane->SetPane();				thePane->wB->SetState(0,ONSTATE);				thePane->wB->SetState(1,OFFSTATE);				thePane->wB->SetState(2,OFFSTATE);				thePane->Display(DRAW, 0, 0);				thePane->UnsetPane();				}			controller->observer->Record(FALSE,FALSE);			controller->observer->SetFrame(0);			controller->Request(NULL, msgUpdate, objObserver, 0);// DAS-VR-FIX 9/26/93			controller->Request(NULL, msgReset, objAxis, 0);	// DAS-VR-FIX 9/26/93				}			break;		case menuVRPlay:			{			WalkBPane*	thePane;						thePane = ((ViewController*)(controller->FindController(toolCRTLView)))->walkBPane;			if ((thePane->theWindow) && 					(((Observer*)(thePane->wB->view))->path->ALength() == 0))				{				thePane->SetPane();				thePane->wB->SetState(0,OFFSTATE);				thePane->wB->SetState(1,ONSTATE);				thePane->wB->SetState(2,OFFSTATE);				thePane->Display(DRAW, 0, 0);				thePane->UnsetPane();				}			((ViewController*)(controller->FindController(toolCRTLView)))->walkBPane;			controller->observer->Walk();			}			break;		case menuVPlayFullScr:			state = !GetState(num);			Select(menuVPlayFullScr, state);			if (state)				VWIHide();			else				VWIShow();			((ViewController*)(controller->FindController(toolCRTLView)))->FullScreen(state);			break;#else		case menuVRStop:			if (recording)				{				controller->observer->Record(FALSE,FALSE);				controller->observer->SetFrame(0);				controller->Request(NULL, msgUpdate, objObserver, 0);// DAS-VR-FIX 9/26/93				controller->Request(NULL, msgReset, objAxis, 0);	// DAS-VR-FIX 9/26/93					recording = FALSE;				}			Select(menuVRRecord, FALSE);			Select(menuVRPlay, FALSE);			Select(menuVRStop, TRUE);			break;		case menuVRPlay:			controller->observer->Walk();			recording = -1;			Select(menuVRRecord, FALSE);			Select(menuVRPlay, TRUE);			Select(menuVRStop, FALSE);			break;		case menuVRRecord:			controller->observer->Record(TRUE,TRUE);			recording = 1;			Select(menuVRRecord, TRUE);			Select(menuVRPlay, FALSE);			Select(menuVRStop, FALSE);			break;		case menuSkyColor:			modelPref = (ModelPreference*)appPref->GetPreference(preferModeler);			skyColor = modelPref->skyColor;			if (VColorWheel(TXTI_SKYCOLOR, &skyColor))				{				modelPref->skyColor = skyColor;				controller->root->SetColor(skyColor,0xFFFF,SURF_SHARED);				modelPref->SetChange(TRUE);				// BILBIL - we need to rebuild the dither table here!		#if MACINTOSH				RebuildScreens();		#endif //MACINTOSH				controller->Request(NULL, msgUpdate, objObserver, 0);				}			break;#endif //!VPLAYER		}	}voidMenuVRWalk::Preempt()	{		Controller			*ctrl;	int					obsState;	AppPreference		*appPref;	NavigatePreference	*navPref;	RenderPreference	*renderPref;	long				rMode,oMode,best,better,faster,fastest;		 	ctrl = controller->GetFrontController();	type = ctrl->GetType();	if((type  == toolCRTLDesign)||(type == toolCRTLView)||(type == toolCRTLWalk)) // VPLAYER - BILBIL		obsState = TRUE;	else		obsState = FALSE;			appPref = controller->GetPreference();	navPref = (NavigatePreference*)appPref->GetPreference(preferNavigate);	renderPref = (RenderPreference*)appPref->GetPreference(preferRenderer);	rMode = renderPref->renderDrawMode;	oMode = renderPref->renderOpenMode;	best = better = faster = fastest = FALSE;	if (rMode == (RENDER_FILL|RENDER_FRAME|RENDER_NOTEXTURES))		{		if (oMode == (RENDER_SEEIN|RENDER_SEEOUT|RENDER_SEECONN))			better = TRUE;		else if (oMode == (RENDER_SEECONN))			faster = TRUE;		}	else if (rMode == (RENDER_FRAME|RENDER_NOTEXTURES))		fastest = TRUE;	else if (rMode == (RENDER_FILL|RENDER_FRAME))		best = TRUE;	Activate(menuLevelVRObserver, obsState);	Select(menuWAngle, FALSE);	Select(menuNAngle, FALSE);	Select(menuTelefoto, FALSE);	if (navPref->focalLength == 15)		Select(menuWAngle, TRUE);	else if (navPref->focalLength == 35)		Select(menuNAngle, TRUE);	else if (navPref->focalLength == 135)		Select(menuTelefoto, TRUE);	Select(menuRBest,best);	Select(menuRBetter,better);	Select(menuRFast,faster);	Select(menuRFastest,fastest);	#if VPLAYER	Select(menuVRPlay, FALSE);	Select(menuVRStop, FALSE);	Select(menuVPlayFullScr, state);#else	Select(menuVRRecord, FALSE);	Select(menuVRPlay, FALSE);	Select(menuVRStop, FALSE);// { DAS-VR-FIX 9/26/93 a few changes to clean this up		if (recording == -1) // we are playing, all we can do here is rewind.		{		SetKeyPos(menuVRStop, menuRewindKeyPos);  	// jca 2 Nov 93 add mnemonic		SetEuroKey(menuVRStop, menuRewindEuroKey);		SetTitle(menuVRStop,TXTM_VCRREWIND);		}	else if (recording == 1) // we are recording, need to use this to stop.		{		Select(menuVRRecord, TRUE);		SetKeyPos(menuVRStop, menuStopKeyPos);  		// jca 2 Nov 93 add mnemonic		SetEuroKey(menuVRStop, menuStopEuroKey);		SetTitle(menuVRStop,TXTM_VCRSTOP);		}	else // nothing is happening, this is a rewind (if that is even an option)		{		SetKeyPos(menuVRStop, menuRewindKeyPos);  	// jca 2 Nov 93 add mnemonic		SetEuroKey(menuVRStop, menuRewindEuroKey);		SetTitle(menuVRStop,TXTM_VCRREWIND);		}// } DAS-VR-FIX 9/26/93 a few changes to clean this up	#endif //VPLAYER	}#endif //VR// MERGE-GOURAUD-PRO [[[#if (!VPLAYER)voidMenuMakeMovie::ctheMenu(WalkDocumentStub *doc)	{		controller = NULL;		cMenu(TXTM_MAKE_MOVIE,doc);#if MACINTOSH	Append(TXTM_PICS);	Append(TXTM_QTIME);	SetKeyPos(menuMMoviePICS,menuPICSKeyPos);	SetKeyPos(menuMMovieQTime,menuQTimeKeyPos);	SetEuroKey(menuMMoviePICS, menuMMoviePICSEuroKey);    SetEuroKey(menuMMovieQTime, menuMMovieQTimeEuroKey);#elif WINDOWS//	Append(TXTM_SNAPSHOT);	//jam GOURAUD-PRO-5 fix JAM removed 8/31/94.  Check for VR working still.	Append(TXTM_FLIC);#if V_AVI	Append(TXTM_AVI);        // AVI will not be in VR, at least not immediately#endif // V_AVI	SetEuroKey(menuMMovieFLIC, menuMMovieFLICEuroKey);    #if V_AVI	SetEuroKey(menuMMovieAVI, menuMMovieAVIEuroKey);    #endif //V_AVI#endif //WINDOWS	}voidMenuMakeMovie::SetController(WalkController *ctrl)	{		controller = ctrl;	}voidMenuMakeMovie::Preempt()	{		int	length;	if(controller)length = controller->observer->path->ALength();	else length = 0;#if !SAVE_DISABLED // jca 22Feb95 #if MACINTOSH	Activate(menuMMoviePICS,(length) ? TRUE : FALSE);	Activate(menuMMovieQTime,(gQuickTime&&length) ? TRUE : FALSE ); #elif WINDOWS	Activate(menuMMovieFLIC,(length) ? TRUE : FALSE);  #if V_AVI	Activate(menuMMovieAVI,(length) ? TRUE : FALSE);  #endif // V_AVI #endif //WINDOWS#else  // SAVE_DISABLED #if MACINTOSH	Activate(menuMMoviePICS, FALSE);	Activate(menuMMovieQTime, FALSE ); #elif WINDOWS	Activate(menuMMovieFLIC, FALSE);  #if V_AVI	Activate(menuMMovieAVI, FALSE);  #endif // V_AVI #endif //WINDOWS#endif //!SAVE_DISABLED // jca 22Feb95	}	voidMenuMakeMovie::Action(int num, long modifier)	{#if !SAVE_DISABLED // jca 22Feb95	switch(num)		{#if MACINTOSH		case menuMMoviePICS: pdc(((WalkDocumentStub *)document))->Import(export,formatPICS);  		break;		case menuMMovieQTime: pdc(((WalkDocumentStub *)document))->Import(export,formatQuickTime); break;#elif WINDOWS		case menuMMovieFLIC: pdc(((WalkDocumentStub *)document))->Import(export,formatFLIC);		break;#if V_AVI		case menuMMovieAVI: pdc(((WalkDocumentStub *)document))->Import(export,formatAVI);		break;#endif //V_AVI#endif //WINDOWS		}#endif // !SAVE_DISABLED // jca 22Feb95	}#endif //!VPLAYER// MERGE-GOURAUD-PRO ]]]