#include "VTypes.h"#include "VToolbox.h"#include "Cnfdntl.h"#include "Serial.h"#include "Prsnlize.h"#include "VMain.h"#include "VDialog.h"#include "VGutil.h"#include "VError.h"#include "VTextDef.h"#include "VSound.h"#include "VItem.h"#include <stdio.h>#include <string.h>#include "AppText.h"		// ABD JAN95strPtr dateString=TXT_DATE_STRING;	// PRO-JAPvoid Confidential(void);struct VConfidential:V_Dialog	{	/* --- */	void cVConfidential(void);	};/*extern*/ char *termination;voidVConfidential::cVConfidential(void){Rect r1,r2;V_EditText *t1;AlertDialog *alert;V_Text *tdate;string str1[255],str2[255];int l1,l2,i,j;int notDone=TRUE;string **str;V_Icon *icon;V_CtrlButton_Die *button;V_Text *someText;time_t date=0;int result;GetScreen(&r1);r2.left = (r1.right+r1.left-VPWIDTH)>>1;r2.right=r2.left+VPWIDTH;r2.top=(r1.bottom+r1.top-VPHEIGHT)>>1;r2.bottom=r2.top+VPHEIGHT;cDialog(&r2);r2.right-=r2.left;r2.bottom-=r2.top;r2.left=r2.top=0;r1.right=r2.right-8;r1.left=r1.right-32;r1.top=r2.top+8;r1.bottom=r1.top+32;icon = new(V_Icon);icon->cItem();icon->SetRect(&r1);icon->SetIconID(128);AddItem(icon);r1.right=r2.right-8;r1.bottom=r2.bottom-8;r1.top=r1.bottom-25;r1.left=r1.right-100;button = new(V_CtrlButton_Die);button->cItem();button->SetRect(&r1);button->SetText(TXTC_OK);button->SetFlag(FALSE);AddItem(button);r1.right=r1.left-16;r1.left=r1.right-100;button = new(V_CtrlButton_Die);button->cItem();button->SetRect(&r1);button->SetText(TXTC_CANCEL);button->SetFlag(FALSE);AddItem(button);r1.right=r1.left-16;r1.left=r1.right-100;/*button = new(V_CtrlButton_Die);button->cItem();button->SetRect(&r1);button->SetText(TXT_NOTRESALE);button->SetFlag(2);AddItem(button);*/r1.left=8;r1.top=8;r1.right=r2.right-100;r1.bottom=r1.top+40;someText = new(V_Text);someText->cItem();someText->SetRect(&r1);someText->SetText(TXT_PRSNCOPY);AddItem(someText);r1.right=r2.right-8;r1.top=r1.bottom+8;r1.bottom=r1.top+16;someText = new(V_Text);someText->cItem();someText->SetRect(&r1);someText->SetText(TXT_SERIALNUM);AddItem(someText);//((V_StatText *)new(V_StatText))->cStatText(this,&r1,(strPtr)"Serial Number:",teJustLeft,0,0,0);r1.top=r1.bottom+8;r1.bottom=r1.top+16;t1 = new(V_EditText);t1->cItem();t1->SetRect(&r1);t1->SetText("");AddItem(t1);r1.top=r1.bottom+8;r1.bottom=r1.top+16;sprintf((char *)str1,"%s %s",termination,dateString);tdate = new(V_Text);tdate->cItem();tdate->SetRect(&r1);tdate->SetText(str1);AddItem(tdate);r1.top=r1.bottom+8;r1.bottom=r1.top+16;if(GetVersion(str1))	{	sprintf((char *)str2,"%s %s",TXT_VERSION,str1);	someText->cItem();	someText = new(V_Text);	someText->SetRect(&r1);	someText->SetText(str2);	AddItem(someText);	}else Damaged();Show();while(notDone)	{	if(result = Modal())		{		t1->GetText(str1);		l1=0;		while(str1[l1])l1++;		if(l1!=8)			{			VPlaySound(beepSound);			//SysBeep(10);			alert=new(AlertDialog);			alert->cAlertDialog(TXT_INVALSN);			}		else			{			int err;						for(i=0;i<sizeof(alphaBeta)/sizeof(struct tester)&&notDone;i++)				{				for(j=0;j<8;j++)					if(alphaBeta[i].what[j]!=str1[j])break;				if(j==8)/*this was the one!*/					{#if MACINTOSH					/*------------------------save the serial number*/					UseResFile(appResFile);					l1=strlen(alphaBeta[i].what);					str=(string **)NewHandle(l1);					Encode(str1,l1);					for(j=0;j<l1;j++)(*str)[j]=str1[j];					AddResource(str,'dave',1,(unsigned char*)"\p");					ChangedResource(str);					if(err=ResError())						{						ResultError(err);						VExitToShell();						}					WriteResource(str);					/*-----------------------save the expiration date*/					date=Decode(dateString, strlen(dateString));					str=(string **)NewHandle(sizeof(time_t));					*(time_t*)str1=date;					str1[4]=0;					Encode(str1,4);					for(j=0;j<4;j++)(*str)[j]=str1[j];					AddResource(str,'dave',4,(unsigned char*)"\p");					ChangedResource(str);					if(err=ResError())						{						ResultError(err);						VExitToShell();						}						WriteResource(str);					/*---------------------save the user name*/							j=0; while(str1[j]=alphaBeta[i].who[j])j++;					l1=strlen(str1);								str=(strPtr *)NewHandle(l1);					Encode(str1,l1);					for(j=0;j<l1;j++)(*str)[j]=str1[j];					AddResource(str,'dave',2,(unsigned char*)"\p");					ChangedResource(str);					if(err=ResError())						{						ResultError(err);						VExitToShell();						}						WriteResource(str);					/*--------------------save the user organization*/					j=0; while(str2[j]=alphaBeta[i].where[j])j++;					l2=strlen(str2);					str=(strPtr*)NewHandle(l2);					Encode(str2,l2);					for(j=0;j<l2;j++)(*str)[j]=str2[j];					AddResource(str,'dave',3,(unsigned char*)"\p");					ChangedResource(str);					if(err=ResError())						{						ResultError(err);						VExitToShell();						}						WriteResource(str);#endif //MACINTOSH				 	notDone=FALSE;				 	}				}			if(notDone)				{				VPlaySound(beepSound);				//SysBeep(10);				alert=new(AlertDialog);				alert->cAlertDialog(TXT_INVALSN);				}			else				{				alert=new(AlertDialog);				alert->cAlertDialog(TXT_THANKYOU);				Delete();				return; /*the only safe way out*/				}			}		}	else notDone=FALSE; /* we pressed cancel */	}Delete();VExitToShell();}void Confidential(void){VConfidential *c;c = new(VConfidential);c->cVConfidential();c->cVConfidential();}